<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Admin Dashboard - Greia</title>
<link rel="icon" type="image/png" href="../assets/greia (4).png"/>
<link rel="icon" type="image/png" href="../assets/greia logo smaller.png"/>
<link href="../css/global-nav.css" rel="stylesheet"/>
<link href="../css/main.css" rel="stylesheet"/>
<style>
/* Admin Dashboard Styles */
.admin-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
  background: #f8fafc;
  min-height: 100vh;
}

/* Blue Navigation Bar */
.navbar {
  background: #1c0bff !important;
  box-shadow: 0 2px 10px rgba(28, 11, 255, 0.3);
}

.navbar .nav-links a {
  color: white !important;
}

.navbar .nav-links a:hover {
  color: rgb(78, 255, 146) !important;
}

.navbar .dropdown-menu {
  background: white;
  border: 1px solid #1c0bff;
}

.navbar .dropdown-menu a {
  color: #333 !important;
}

.navbar .dropdown-menu a:hover {
  background: #f0f8ff;
  color: #1c0bff !important;
}

/* Keep Connect link green */
.navbar .nav-links a[style*="rgb(78, 255, 146)"] {
  color: rgb(78, 255, 146) !important;
}

/* Mobile nav styling */
.mobile-nav {
  background: #1c0bff !important;
}

.mobile-nav a {
  color: white !important;
}

.mobile-nav a:hover {
  color: rgb(78, 255, 146) !important;
}

.admin-header {
  background: linear-gradient(135deg, #00ffa4  0%, #00ffa4  100%);
  color: white;
  padding: 30px;
  border-radius: 12px;
  margin-bottom: 30px;
  text-align: center;
}

.admin-header h1 {
  margin: 0;
  font-size: 2.5em;
  font-weight: 700;
  color: rgb(23, 23, 23);
}

.admin-header p {
  margin: 10px 0 0;
  opacity: 0.9;
  font-size: 1.1em;
  color: rgb(27, 27, 27);
}

/* Stats Cards */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  text-align: center;
  border: 1px solid #e2e8f0;
}

.stat-card h3 {
  margin: 0 0 10px;
  color: #64748b;
  font-size: 0.9em;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-number {
  font-size: 2.5em;
  font-weight: 700;
  color: #1c0bff;
  margin: 0;
}

.stat-icon {
  font-size: 2em;
  margin-bottom: 10px;
  opacity: 0.7;
}

/* Tab Navigation */
.tab-navigation {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin-bottom: 30px;
  background: white;
  padding: 5px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.tab-btn {
  padding: 12px 20px;
  background: none;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  color: #64748b;
  transition: all 0.2s;
  flex: 1;
  min-width: 120px;
}

.tab-btn.active {
  background: #1c0bff;
  color: white;
}

.tab-btn:hover:not(.active) {
  background: #f1f5f9;
  color: #1c0bff;
}

/* Tab Content */
.tab-content {
  display: none;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  overflow: hidden;
}

.tab-content.active {
  display: block;
}

.tab-header {
  padding: 20px 30px;
  background: #f8fafc;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.tab-header h2 {
  margin: 0;
  color: #1e293b;
  font-size: 1.4em;
}

.search-filter {
  display: flex;
  gap: 10px;
  align-items: center;
}

.search-box {
  position: relative;
}

.search-box input {
  padding: 8px 35px 8px 12px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 14px;
  width: 200px;
}

.search-box .search-icon {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  color: #9ca3af;
  pointer-events: none;
}

.filter-select {
  padding: 8px 12px;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 14px;
  background: white;
}

/* Table Styles */
.data-table {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

.data-table th,
.data-table td {
  padding: 12px 15px;
  text-align: left;
  border-bottom: 1px solid #e2e8f0;
}

.data-table th {
  background: #f8fafc;
  font-weight: 600;
  color: #374151;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.data-table tr:hover {
  background: #f8fafc;
}

.status-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
  text-transform: uppercase;
}

.status-active {
  background: #dcfce7;
  color: #166534;
}

.status-pending {
  background: #fef3c7;
  color: #92400e;
}

.status-inactive {
  background: #fee2e2;
  color: #dc2626;
}

.action-btn {
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  margin: 0 6px 6px 0;
  transition: all 0.2s;
  box-shadow: 0 2px 8px rgba(28,11,255,0.08);
}

.btn-view {
  background: #3b82f6;
  color: white;
}

.btn-edit {
  background: #10b981;
  color: white;
}

.btn-delete {
  background: #ef4444;
  color: white;
}

.btn-approve {
  background: #10b981;
  color: white;
}

.btn-reject {
  background: #ef4444;
  color: white;
}

.action-btn:hover {
  transform: translateY(-2px) scale(1.04);
  box-shadow: 0 4px 12px rgba(28,11,255,0.12);
}
/* Modal for viewing/editing properties/services/ads */
.entity-modal {
  display: none;
  position: fixed;
  z-index: 1001;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
}
.entity-modal-content {
  background-color: white;
  margin: 4% auto;
  padding: 32px;
  border-radius: 16px;
  width: 95%;
  max-width: 700px;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 8px 32px rgba(28,11,255,0.18);
}
.entity-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 18px;
  padding-bottom: 10px;
  border-bottom: 1px solid #e2e8f0;
}
.entity-modal-header h3 {
  margin: 0;
  color: #1e293b;
}
.close-entity-modal {
  background: none;
  border: none;
  font-size: 28px;
  cursor: pointer;
  color: #64748b;
  padding: 0;
  line-height: 1;
}
.entity-detail-row {
  display: flex;
  margin-bottom: 14px;
  padding: 8px;
  background: #f8fafc;
  border-radius: 6px;
}
.entity-detail-label {
  font-weight: 600;
  color: #374151;
  width: 160px;
  flex-shrink: 0;
}
.entity-detail-value {
  color: #64748b;
  flex: 1;
}
.entity-edit-form label {
  display: block;
  margin-bottom: 10px;
  font-weight: 500;
  color: #222;
}
.entity-edit-form input,
.entity-edit-form select,
.entity-edit-form textarea {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  font-size: 1em;
  margin-top: 4px;
  margin-bottom: 8px;
  background: #f8fafc;
  transition: border 0.18s;
  box-sizing: border-box;
}
.entity-edit-form button {
  background: #1c0bff;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 12px 28px;
  font-size: 1.08em;
  font-weight: 500;
  cursor: pointer;
  margin-top: 8px;
  transition: background 0.18s;
}
.entity-edit-form button:hover {
  background: #0a0b3c;
}

.loading {
  text-align: center;
  padding: 40px;
  color: #64748b;
}

.empty-state {
  text-align: center;
  padding: 60px 40px;
  color: #64748b;
}

.empty-state .icon {
  font-size: 3em;
  margin-bottom: 20px;
  opacity: 0.5;
}

/* Responsive */
@media (max-width: 768px) {
  .admin-container {
    padding: 10px;
  }
  
  .tab-navigation {
    flex-direction: column;
  }
  
  .tab-btn {
    min-width: unset;
  }
  
  .data-table {
    font-size: 12px;
  }
  
  .data-table th,
  .data-table td {
    padding: 8px 10px;
  }
  
  .search-filter {
    flex-direction: column;
    align-items: stretch;
  }
  
  .search-box input {
    width: 100%;
  }
}

/* User Details Modal */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
}

.modal-content {
  background-color: white;
  margin: 5% auto;
  padding: 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #e2e8f0;
}

.modal-header h3 {
  margin: 0;
  color: #1e293b;
}

.close-modal {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #64748b;
  padding: 0;
  line-height: 1;
}

.user-detail-row {
  display: flex;
  margin-bottom: 15px;
  padding: 10px;
  background: #f8fafc;
  border-radius: 6px;
}

.user-detail-label {
  font-weight: 600;
  color: #374151;
  width: 150px;
  flex-shrink: 0;
}

.user-detail-value {
  color: #64748b;
  flex: 1;
}
</style>
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar">
  <div class="navbar-thirds">
    <div class="navbar-third left">
      <ul class="nav-links left-links" style="position:relative; z-index:100;">
        <li class="dropdown" style="position:relative;">
          <a href="/pages/buy.html" style="position:relative; z-index:101;">Property</a>
          <ul class="dropdown-menu" style="top:100%; left:0; margin-top:0; padding-top:0; border-top:0;">
            <li><a href="/pages/buy.html">Buy</a></li>
            <li><a href="/pages/rent.html">Rent</a></li>
            <li><a href="/pages/commercial.html">Commercial</a></li>
            <li><a href="/pages/buy.html">Apartments</a></li>
            <li><a href="/pages/sell.html">Sell</a></li>
            <li><a href="/pages/valuations.html">Valuations</a></li>
            <li><a href="/pages/buy.html">New Homes</a></li>
          </ul>
        </li>
        <li class="dropdown" style="position:relative;">
          <a href="/pages/agents.html" style="color: rgb(78, 255, 146); position:relative; z-index:101;" class="referral-dropdown-toggle">Connect</a>
          <ul class="dropdown-menu" style="top:100%; left:0; margin-top:0; padding-top:0; border-top:0;">
            <li><a href="/pages/agents.html">Find an Agent</a></li>
            <li class="nested-dropdown" style="position: relative;">
              <a href="/pages/agents.html" class="referral-dropdown-toggle" tabindex="0" aria-haspopup="true" aria-expanded="false">Referral Agents ‚ñ∏</a>
              <ul class="dropdown-menu referral-dropdown" style="display:none; position: absolute; left: 100%; top: 0; background: white; list-style:none; padding:10px; border:1px solid #ccc; min-width: 220px; z-index: 2000;">
                <li><a href="/pages/agents.html?subtype=luxury">Luxury Home Agents</a></li>
                <li><a href="/pages/agents.html?subtype=lettings">Lettings Agents</a></li>
                <li><a href="/pages/agents.html?subtype=newhomes">New Homes Agents</a></li>
                <li><a href="/pages/agents.html?subtype=commercial">Commercial Agents</a></li>
                <li><a href="/pages/agents.html?subtype=residential">Residential Agents</a></li>
                <li><a href="/pages/agents.html?subtype=developer">Developer Agents</a></li>
                <li><a href="/pages/agents.html?subtype=timeshare">Timeshare Agents</a></li>
              </ul>
            </li>
            <li><a href="/pages/coaching.html">Coaching</a></li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="navbar-third center">
      <div class="logo">
        <a href="/index.html">
          <img alt="Logo" src="../assets/greia (4).png" style="height: auto; max-height: 140px;"/>
        </a>
      </div>
    </div>
    <div class="navbar-third right">
      <ul class="nav-links right-links">
        <li>
          <a href="/pages/services.html" class="fancy-underline">Our Services</a>
        </li>
        <li>
          <a href="/pages/concierge.html" class="fancy-underline">Concierge</a>
        </li>
        <li class="dropdown" id="auth-menu">
          <a href="/pages/login.html" id="login-btn">Log In</a>
          <ul class="dropdown-menu" id="login-dropdown">
            <li><a href="/pages/login.html">Sign In</a></li>
            <li><a href="/pages/register.html">Register</a></li>
            <li><a href="/pages/forgot-password.html">Forgot Password?</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
  <button aria-label="Toggle navigation" class="hamburger-menu">
    <span></span>
    <span></span>
    <span></span>
  </button>
  <!-- Mobile nav menu -->
  <div class="mobile-nav-overlay"></div>
  <div class="mobile-nav">
    <ul>
      <li class="dropdown">
        <a href="/pages/buy.html" class="dropdown-toggle">Property</a>
        <ul class="dropdown-menu">
          <li><a href="/pages/buy.html">Buy</a></li>
          <li><a href="/pages/rent.html">Rent</a></li>
          <li><a href="/pages/commercial.html">Commercial</a></li>
          <li><a href="/pages/buy.html">Apartments</a></li>
          <li><a href="/pages/sell.html">Sell</a></li>
          <li><a href="/pages/valuations.html">Valuations</a></li>
          <li><a href="/pages/buy.html">New Homes</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="/pages/agents.html" class="dropdown-toggle" style="color: rgb(78, 255, 146);">Connect</a>
        <ul class="dropdown-menu">
          <li><a href="/pages/agents.html">Find an Agent</a></li>
          <li><a href="/pages/agents.html">Referral Agents</a></li>
          <li><a href="/pages/coaching.html">Coaching</a></li>
        </ul>
      </li>
      <li><a href="/pages/services.html">Our Services</a></li>
      <li><a href="/pages/concierge.html">Concierge</a></li>
      <li class="dropdown" id="mobile-auth-menu">
        <a href="/pages/login.html" class="dropdown-toggle" id="mobile-login-btn">Log In</a>
        <ul class="dropdown-menu" id="mobile-login-dropdown">
          <li><a href="/pages/login.html">Sign In</a></li>
          <li><a href="/pages/register.html">Register</a></li>
          <li><a href="/pages/forgot-password.html">Forgot Password?</a></li>
        </ul>
      </li>
    </ul>
  </div>
</nav>

<!-- Admin Dashboard Content -->
<div class="admin-container">
  <!-- Dashboard Header -->
  <div class="admin-header">
    <h1>üõ†Ô∏è Admin Dashboard</h1>
    <p>Manage your D4Rent platform with comprehensive oversight and control</p>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üë•</div>
      <h3>Total Users</h3>
      <div class="stat-number" id="total-users">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üè†</div>
      <h3>Live Properties</h3>
      <div class="stat-number" id="live-properties">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üõéÔ∏è</div>
      <h3>Active Services</h3>
      <div class="stat-number" id="active-services">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üì¢</div>
      <h3>Active Ads</h3>
      <div class="stat-number" id="active-ads">-</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚è≥</div>
      <h3>Pending Approvals</h3>
      <div class="stat-number" id="pending-approvals">-</div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button class="tab-btn active" onclick="showTab('users')">Users</button>
    <button class="tab-btn" onclick="showTab('properties')">Properties</button>
    <button class="tab-btn" onclick="showTab('services')">Services</button>
    <button class="tab-btn" onclick="showTab('advertisements')">Advertisements</button>
    <button class="tab-btn" onclick="showTab('pending-properties')">Pending Properties</button>
    <button class="tab-btn" onclick="showTab('pending-services')">Pending Services</button>
    <button class="tab-btn" onclick="showTab('pending-ads')">Pending Ads</button>
  </div>

  <!-- Users Tab -->
  <div id="users-tab" class="tab-content active">
    <div class="tab-header">
      <h2>üë• Users Management</h2>
      <div class="search-filter">
        <div class="search-box">
          <input type="text" placeholder="Search users..." id="users-search">
          <span class="search-icon">üîç</span>
        </div>
        <select class="filter-select" id="users-filter">
          <option value="">All Roles</option>
          <option value="User">User</option>
          <option value="Real Estate Agent">Real Estate Agent</option>
          <option value="Service Agent">Service Agent</option>
          <option value="Concierge Agent">Concierge Agent</option>
          <option value="Admin">Admin</option>
        </select>
      </div>
    </div>
    <div id="users-content">
      <div class="loading">Loading users...</div>
    </div>
  </div>

  <!-- Properties Tab -->
  <div id="properties-tab" class="tab-content">
    <div class="tab-header">
      <h2>üè† Live Properties</h2>
      <div class="search-filter">
        <div class="search-box">
          <input type="text" placeholder="Search properties..." id="properties-search">
          <span class="search-icon">üîç</span>
        </div>
        <select class="filter-select" id="properties-filter">
          <option value="">All Types</option>
          <option value="House">House</option>
          <option value="Apartment">Apartment</option>
          <option value="Commercial">Commercial</option>
          <option value="Land">Land</option>
        </select>
      </div>
    </div>
    <div id="properties-content">
      <div class="loading">Loading properties...</div>
    </div>
  </div>

  <!-- Services Tab -->
  <div id="services-tab" class="tab-content">
    <div class="tab-header">
      <h2>üõéÔ∏è Active Services</h2>
      <div class="search-filter">
        <div class="search-box">
          <input type="text" placeholder="Search services..." id="services-search">
          <span class="search-icon">üîç</span>
        </div>
        <select class="filter-select" id="services-filter">
          <option value="">All Categories</option>
          <option value="Property Management">Property Management</option>
          <option value="Maintenance & Repairs">Maintenance & Repairs</option>
          <option value="Cleaning Services">Cleaning Services</option>
          <option value="Legal Services">Legal Services</option>
        </select>
      </div>
    </div>
    <div id="services-content">
      <div class="loading">Loading services...</div>
    </div>
  </div>

  <!-- Advertisements Tab -->
  <div id="advertisements-tab" class="tab-content">
    <div class="tab-header">
      <h2>üì¢ Active Advertisements</h2>
      <div class="search-filter">
        <div class="search-box">
          <input type="text" placeholder="Search advertisements..." id="ads-search">
          <span class="search-icon">üîç</span>
        </div>
        <select class="filter-select" id="ads-filter">
          <option value="">All Categories</option>
          <option value="Property Services">Property Services</option>
          <option value="Home Improvement">Home Improvement</option>
          <option value="Legal Services">Legal Services</option>
          <option value="Financial Services">Financial Services</option>
        </select>
      </div>
    </div>
    <div id="advertisements-content">
      <div class="loading">Loading advertisements...</div>
    </div>
  </div>

  <!-- Pending Properties Tab -->
  <div id="pending-properties-tab" class="tab-content">
    <div class="tab-header">
      <h2>‚è≥ Pending Properties</h2>
      <div class="search-filter">
        <div class="search-box">
          <input type="text" placeholder="Search pending properties..." id="pending-properties-search">
          <span class="search-icon">üîç</span>
        </div>
      </div>
    </div>
    <div id="pending-properties-content">
      <div class="loading">Loading pending properties...</div>
    </div>
  </div>

  <!-- Pending Services Tab -->
  <div id="pending-services-tab" class="tab-content">
    <div class="tab-header">
      <h2>‚è≥ Pending Services</h2>
      <div class="search-filter">
        <div class="search-box">
          <input type="text" placeholder="Search pending services..." id="pending-services-search">
          <span class="search-icon">üîç</span>
        </div>
      </div>
    </div>
    <div id="pending-services-content">
      <div class="loading">Loading pending services...</div>
    </div>
  </div>

  <!-- Pending Ads Tab -->
  <div id="pending-ads-tab" class="tab-content">
    <div class="tab-header">
      <h2>‚è≥ Pending Advertisements</h2>
      <div class="search-filter">
        <div class="search-box">
          <input type="text" placeholder="Search pending ads..." id="pending-ads-search">
          <span class="search-icon">üîç</span>
        </div>
      </div>
    </div>
    <div id="pending-ads-content">
      <div class="loading">Loading pending advertisements...</div>
    </div>
  </div>
</div>

<!-- User Details Modal -->
<div id="user-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>User Details</h3>
      <button class="close-modal" onclick="closeUserModal()">&times;</button>
    </div>
    <div id="user-modal-content">
      <!-- User details will be populated here -->
    </div>
  </div>
</div>

<!-- Footer -->
<footer>
<div class="footer-container">
<div class="footer-image">
<img alt="D4Rent Footer Logo" src="../assets/greia (4).png" style="height: auto; max-height: 100px;"/>
</div>
<div class="footer-section">
<h3 style="font-size: smaller;; font-size: larger;">Contact Details</h3>
<p style="font-size: larger;">Greia</p>
<p style="font-size: larger;">36 Upper Baggot St, Ballsbridge, D4</p>
<p style="font-size: larger;">Phone: 01 442 7303</p>
<p style="font-size: larger;">087 169 9498</p>
<p>Email: <a href="mailto:info@greia.ie">info@greia.ie</a></p>
</div>
<div class="footer-section">
<h3>Quick Links</h3>
<ul>
<li><a href="pages/buy.html">Buy</a></li>
<li><a href="pages/rent.html">Rent</a></li>
<li><a href="pages/sell.html">Sell</a></li>
<li><a href="pages/commercial.html">Commercial</a></li>
<li><a href="pages/agents.html">Agents</a></li>
<li><a href="pages/contact-us.html">Contact Us</a></li>
<li><a href="pages/listyourrentalsfree.html">List Your Rentals Free</a></li>
</ul>
</div>
<div class="footer-section">
<h3>Policy Links</h3>
<ul>
<li><a href="pages/privacy-policy.html">Privacy Policy</a></li>
<li><a href="pages/terms-of-service.html">Terms of Service</a></li>
<li><a href="pages/cookie-policy.html">Cookie Policy</a></li>
</ul>
</div>
<div class="footer-section">
<h3>Connect with Us</h3>
<ul>
<li><a href="https://www.facebook.com/profile.php?id=61577099380616" target="_blank">Facebook</a></li>
<li><a href="https://www.instagram.com/dublin4rent/" target="_blank">Instagram</a></li>
<li><a href="https://www.tiktok.com/@d4rent.ie" target="_blank">Tiktok</a></li>
</ul>
</div>
</div>
</footer>

<!-- Global Navigation Scripts -->
<script src="/js/global-nav.js"></script>
<script src="/js/global-search.js"></script>
<script src="/scripts/main.js"></script>

<script>

// Define API_BASE_URL if not already defined
if (typeof API_BASE_URL === 'undefined') {
    var API_BASE_URL = 'https://api.d4rent.ie';
}

// Authentication-aware navigation
function isUserLoggedIn() {
  return localStorage.getItem('token') || sessionStorage.getItem('token');
}

function updateNavigation() {
  const authMenu = document.getElementById('auth-menu');
  const loginBtn = document.getElementById('login-btn');
  const loginDropdown = document.getElementById('login-dropdown');
  
  const mobileAuthMenu = document.getElementById('mobile-auth-menu');
  const mobileLoginBtn = document.getElementById('mobile-login-btn');
  const mobileLoginDropdown = document.getElementById('mobile-login-dropdown');

  if (isUserLoggedIn()) {
    // Desktop navigation
    if (authMenu && loginBtn) {
      authMenu.classList.remove('dropdown');
      loginBtn.textContent = 'myGREIA';
      loginBtn.href = '/pages/profile.html';
      if (loginDropdown) {
        loginDropdown.style.display = 'none';
      }
    }
    
    // Mobile navigation
    if (mobileAuthMenu && mobileLoginBtn) {
      mobileAuthMenu.classList.remove('dropdown');
      mobileLoginBtn.textContent = 'myGREIA';
      mobileLoginBtn.href = '/pages/profile.html';
      if (mobileLoginDropdown) {
        mobileLoginDropdown.style.display = 'none';
      }
    }
  } else {
    // Desktop navigation
    if (authMenu && loginBtn) {
      authMenu.classList.add('dropdown');
      loginBtn.textContent = 'Log In';
      loginBtn.href = '/pages/login.html';
      if (loginDropdown) {
        loginDropdown.style.display = '';
      }
    }
    
    // Mobile navigation
    if (mobileAuthMenu && mobileLoginBtn) {
      mobileAuthMenu.classList.add('dropdown');
      mobileLoginBtn.textContent = 'Log In';
      mobileLoginBtn.href = '/pages/login.html';
      if (mobileLoginDropdown) {
        mobileLoginDropdown.style.display = '';
      }
    }
  }
}

// Admin Dashboard Functionality
let allUsers = [];
let allProperties = [];
let allServices = [];
let allAdvertisements = [];
let pendingProperties = [];
let pendingServices = [];
let pendingAds = [];

// Tab Management
function showTab(tabName) {
  // Hide all tabs
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Remove active class from all buttons
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Show selected tab
  document.getElementById(tabName + '-tab').classList.add('active');
  
  // Add active class to clicked button
  event.target.classList.add('active');
  
  // Load data for the tab if not already loaded
  loadTabData(tabName);
}

// Load data for specific tab
function loadTabData(tabName) {
  switch(tabName) {
    case 'users':
      if (allUsers.length === 0) loadUsers();
      break;
    case 'properties':
      if (allProperties.length === 0) loadProperties();
      break;
    case 'services':
      if (allServices.length === 0) loadServices();
      break;
    case 'advertisements':
      if (allAdvertisements.length === 0) loadAdvertisements();
      break;
    case 'pending-properties':
      if (pendingProperties.length === 0) loadPendingProperties();
      break;
    case 'pending-services':
      if (pendingServices.length === 0) loadPendingServices();
      break;
    case 'pending-ads':
      if (pendingAds.length === 0) loadPendingAds();
      break;
  }
}

// Load statistics
async function loadStats() {
  try {
    const token = localStorage.getItem('token') || sessionStorage.getItem('token');
    const response = await fetch(`${API_BASE_URL}/api/admin/stats`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error('Failed to load statistics');
    }
    
    const stats = await response.json();
    
    document.getElementById('total-users').textContent = stats.totalUsers.toLocaleString();
    document.getElementById('live-properties').textContent = stats.liveProperties.toLocaleString();
    document.getElementById('active-services').textContent = stats.activeServices.toLocaleString();
    document.getElementById('active-ads').textContent = stats.activeAds.toLocaleString();
    document.getElementById('pending-approvals').textContent = stats.pendingApprovals.toLocaleString();
  } catch (error) {
    console.error('Error loading stats:', error);
    // Fallback to display zeros
    document.getElementById('total-users').textContent = '0';
    document.getElementById('live-properties').textContent = '0';
    document.getElementById('active-services').textContent = '0';
    document.getElementById('active-ads').textContent = '0';
    document.getElementById('pending-approvals').textContent = '0';
  }
}

// Load Users
async function loadUsers() {
  try {
    const token = localStorage.getItem('token') || sessionStorage.getItem('token');
    const response = await fetch(`${API_BASE_URL}/api/admin/users`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error('Failed to load users');
    }
    
    allUsers = await response.json();
    renderUsers(allUsers);
  } catch (error) {
    console.error('Error loading users:', error);
    document.getElementById('users-content').innerHTML = '<div class="empty-state"><div class="icon">‚ùå</div><p>Error loading users</p></div>';
  }
}

// Render Users Table
function renderUsers(users) {
  const content = document.getElementById('users-content');
  
  if (users.length === 0) {
    content.innerHTML = '<div class="empty-state"><div class="icon">üë•</div><p>No users found</p></div>';
    return;
  }
  
  const table = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Role</th>
          <th>Company</th>
          <th>Status</th>
          <th>Joined</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${users.map(user => `
          <tr>
            <td>${user.full_name || 'N/A'}</td>
            <td>${user.email || 'N/A'}</td>
            <td>${user.phone_number || 'N/A'}</td>
            <td>${user.role || 'User'}</td>
            <td>${user.company || 'N/A'}</td>
            <td><span class="status-badge status-${user.status || 'active'}">${user.status || 'Active'}</span></td>
            <td>${new Date(user.created_at).toLocaleDateString()}</td>
            <td>
              <button class="action-btn btn-view" onclick="viewUser(${user.id})">View</button>
              <button class="action-btn btn-edit" onclick="editUser(${user.id})">Edit</button>
              <button class="action-btn btn-delete" onclick="deleteUser(${user.id})">Delete</button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  
  content.innerHTML = table;
}

// Load Properties
async function loadProperties() {
  try {
    const token = localStorage.getItem('token') || sessionStorage.getItem('token');
    const response = await fetch(`${API_BASE_URL}/api/admin/properties`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error('Failed to load properties');
    }
    
    allProperties = await response.json();
    renderProperties(allProperties);
  } catch (error) {
    console.error('Error loading properties:', error);
    document.getElementById('properties-content').innerHTML = '<div class="empty-state"><div class="icon">‚ùå</div><p>Error loading properties</p></div>';
  }
}

// Render Properties Table
function renderProperties(properties) {
  const content = document.getElementById('properties-content');
  
  if (properties.length === 0) {
    content.innerHTML = '<div class="empty-state"><div class="icon">üè†</div><p>No properties found</p></div>';
    return;
  }
  
  const table = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Address</th>
          <th>Type</th>
          <th>Price</th>
          <th>Owner</th>
          <th>Status</th>
          <th>Listed</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${properties.map(property => `
          <tr>
            <td>${property.title || 'N/A'}</td>
            <td>${property.address || 'N/A'}</td>
            <td>${property.property_type || 'N/A'}</td>
            <td>‚Ç¨${property.price?.toLocaleString() || 'N/A'}</td>
            <td>${property.user_name || 'N/A'}</td>
            <td><span class="status-badge status-${property.status || 'active'}">${property.status || 'Active'}</span></td>
            <td>${new Date(property.created_at).toLocaleDateString()}</td>
            <td>
              <button class="action-btn btn-view" onclick="viewProperty(${property.id})">View</button>
              <button class="action-btn btn-edit" onclick="editProperty(${property.id})">Edit</button>
              <button class="action-btn btn-delete" onclick="deleteProperty(${property.id})">Delete</button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  
  content.innerHTML = table;
}

// Load Services
async function loadServices() {
  try {
    const token = localStorage.getItem('token') || sessionStorage.getItem('token');
    const response = await fetch(`${API_BASE_URL}/api/admin/services`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error('Failed to load services');
    }
    
    allServices = await response.json();
    renderServices(allServices);
  } catch (error) {
    console.error('Error loading services:', error);
    document.getElementById('services-content').innerHTML = '<div class="empty-state"><div class="icon">‚ùå</div><p>Error loading services</p></div>';
  }
}

// Render Services Table
function renderServices(services) {
  const content = document.getElementById('services-content');
  
  if (services.length === 0) {
    content.innerHTML = '<div class="empty-state"><div class="icon">üõéÔ∏è</div><p>No services found</p></div>';
    return;
  }
  
  const table = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Service Name</th>
          <th>Category</th>
          <th>Price Range</th>
          <th>Provider</th>
          <th>Status</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${services.map(service => `
          <tr>
            <td>${service.name || 'N/A'}</td>
            <td>${service.category || 'N/A'}</td>
            <td>${service.price_range || 'N/A'}</td>
            <td>${service.user_name || 'N/A'}</td>
            <td><span class="status-badge status-${service.status || 'active'}">${service.status || 'Active'}</span></td>
            <td>${new Date(service.created_at).toLocaleDateString()}</td>
            <td>
              <button class="action-btn btn-view" onclick="viewService(${service.id})">View</button>
              <button class="action-btn btn-edit" onclick="editService(${service.id})">Edit</button>
              <button class="action-btn btn-delete" onclick="deleteService(${service.id})">Delete</button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  
  content.innerHTML = table;
}

// Load Advertisements
async function loadAdvertisements() {
  try {
    const token = localStorage.getItem('token') || sessionStorage.getItem('token');
    const response = await fetch(`${API_BASE_URL}/api/admin/advertisements`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error('Failed to load advertisements');
    }
    
    allAdvertisements = await response.json();
    renderAdvertisements(allAdvertisements);
  } catch (error) {
    console.error('Error loading advertisements:', error);
    document.getElementById('advertisements-content').innerHTML = '<div class="empty-state"><div class="icon">‚ùå</div><p>Error loading advertisements</p></div>';
  }
}

// Render Advertisements Table
function renderAdvertisements(ads) {
  const content = document.getElementById('advertisements-content');
  
  if (ads.length === 0) {
    content.innerHTML = '<div class="empty-state"><div class="icon">üì¢</div><p>No advertisements found</p></div>';
    return;
  }
  
  const table = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Category</th>
          <th>Sub Category</th>
          <th>Price</th>
          <th>Advertiser</th>
          <th>Contact Method</th>
          <th>Target Audience</th>
          <th>Approval Status</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${ads.map(ad => `
          <tr>
            <td>${ad.title || 'N/A'}</td>
            <td>${ad.category || 'N/A'}</td>
            <td>${ad.sub_category || 'N/A'}</td>
            <td>${ad.price ? ad.currency + ' ' + ad.price : 'N/A'}</td>
            <td>${ad.user_name || 'N/A'}</td>
            <td>${ad.contact_method || 'N/A'}</td>
            <td>${ad.target_audience || 'N/A'}</td>
            <td><span class="status-badge status-${ad.approved ? 'active' : 'pending'}">${ad.approved ? 'Approved' : 'Pending'}</span></td>
            <td>${new Date(ad.created_at).toLocaleDateString()}</td>
            <td>
              <button class="action-btn btn-view" onclick="viewAd(${ad.id})">View</button>
              <button class="action-btn btn-edit" onclick="editAd(${ad.id})">Edit</button>
              <button class="action-btn btn-delete" onclick="deleteAd(${ad.id})">Delete</button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  
  content.innerHTML = table;
}

// Load Pending Properties
async function loadPendingProperties() {
  try {
    const token = localStorage.getItem('token') || sessionStorage.getItem('token');
    const response = await fetch(`${API_BASE_URL}/api/admin/pending-properties`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error('Failed to load pending properties');
    }
    
    pendingProperties = await response.json();
    renderPendingProperties(pendingProperties);
  } catch (error) {
    console.error('Error loading pending properties:', error);
    document.getElementById('pending-properties-content').innerHTML = '<div class="empty-state"><div class="icon">‚ùå</div><p>Error loading pending properties</p></div>';
  }
}

// Render Pending Properties Table
function renderPendingProperties(properties) {
  const content = document.getElementById('pending-properties-content');
  
  if (properties.length === 0) {
    content.innerHTML = '<div class="empty-state"><div class="icon">‚è≥</div><p>No pending properties</p></div>';
    return;
  }
  
  const table = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Address</th>
          <th>Type</th>
          <th>Price</th>
          <th>Owner</th>
          <th>Submitted</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${properties.map(property => `
          <tr>
            <td>${property.title || 'N/A'}</td>
            <td>${property.address || 'N/A'}</td>
            <td>${property.property_type || 'N/A'}</td>
            <td>‚Ç¨${property.price?.toLocaleString() || 'N/A'}</td>
            <td>${property.user_name || 'N/A'}</td>
            <td>${new Date(property.created_at).toLocaleDateString()}</td>
            <td>
              <button class="action-btn btn-view" onclick="viewProperty(${property.id})">View</button>
              <button class="action-btn btn-approve" onclick="approveProperty(${property.id})">Approve</button>
              <button class="action-btn btn-reject" onclick="rejectProperty(${property.id})">Reject</button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  
  content.innerHTML = table;
}

// Load Pending Services
async function loadPendingServices() {
  try {
    const token = localStorage.getItem('token') || sessionStorage.getItem('token');
    const response = await fetch(`${API_BASE_URL}/api/admin/pending-services`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error('Failed to load pending services');
    }
    
    pendingServices = await response.json();
    renderPendingServices(pendingServices);
  } catch (error) {
    console.error('Error loading pending services:', error);
    document.getElementById('pending-services-content').innerHTML = '<div class="empty-state"><div class="icon">‚ùå</div><p>Error loading pending services</p></div>';
  }
}

function renderPendingServices(services) {
  const content = document.getElementById('pending-services-content');
  
  if (services.length === 0) {
    content.innerHTML = '<div class="empty-state"><div class="icon">‚è≥</div><p>No pending services</p></div>';
    return;
  }
  
  const table = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Service Name</th>
          <th>Category</th>
          <th>Price Range</th>
          <th>Provider</th>
          <th>Submitted</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${services.map(service => `
          <tr>
            <td>${service.name || 'N/A'}</td>
            <td>${service.category || 'N/A'}</td>
            <td>${service.price_range || 'N/A'}</td>
            <td>${service.user_name || 'N/A'}</td>
            <td>${new Date(service.created_at).toLocaleDateString()}</td>
            <td>
              <button class="action-btn btn-view" onclick="viewService(${service.id})">View</button>
              <button class="action-btn btn-approve" onclick="approveService(${service.id})">Approve</button>
              <button class="action-btn btn-reject" onclick="rejectService(${service.id})">Reject</button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  
  content.innerHTML = table;
}

// Load Pending Ads
async function loadPendingAds() {
  try {
    const token = localStorage.getItem('token') || sessionStorage.getItem('token');
    const response = await fetch(`${API_BASE_URL}/api/admin/pending-advertisements`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error('Failed to load pending advertisements');
    }
    
    pendingAds = await response.json();
    renderPendingAds(pendingAds);
  } catch (error) {
    console.error('Error loading pending advertisements:', error);
    document.getElementById('pending-ads-content').innerHTML = '<div class="empty-state"><div class="icon">‚ùå</div><p>Error loading pending advertisements</p></div>';
  }
}

function renderPendingAds(ads) {
  const content = document.getElementById('pending-ads-content');
  
  if (ads.length === 0) {
    content.innerHTML = '<div class="empty-state"><div class="icon">‚è≥</div><p>No pending advertisements</p></div>';
    return;
  }
  
  const table = `
    <table class="data-table">
      <thead>
        <tr>
          <th>Title</th>
          <th>Category</th>
          <th>Sub Category</th>
          <th>Price</th>
          <th>Advertiser</th>
          <th>Contact Method</th>
          <th>Target Location</th>
          <th>Service Radius</th>
          <th>Years Experience</th>
          <th>Submitted</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        ${ads.map(ad => `
          <tr>
            <td>${ad.title || 'N/A'}</td>
            <td>${ad.category || 'N/A'}</td>
            <td>${ad.sub_category || 'N/A'}</td>
            <td>${ad.price ? ad.currency + ' ' + ad.price : 'N/A'}</td>
            <td>${ad.user_name || 'N/A'}</td>
            <td>${ad.contact_method || 'N/A'}</td>
            <td>${ad.target_location || 'N/A'}</td>
            <td>${ad.service_radius ? ad.service_radius + ' km' : 'N/A'}</td>
            <td>${ad.years_in_business || 'N/A'}</td>
            <td>${new Date(ad.created_at).toLocaleDateString()}</td>
            <td>
              <button class="action-btn btn-view" onclick="viewAd(${ad.id})">View</button>
              <button class="action-btn btn-approve" onclick="approveAd(${ad.id})">Approve</button>
              <button class="action-btn btn-reject" onclick="rejectAd(${ad.id})">Reject</button>
            </td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  `;
  
  content.innerHTML = table;
}

// User Modal Functions
function viewUser(userId) {
  const user = allUsers.find(u => u.id === userId);
  if (!user) return;
  
  const modalContent = document.getElementById('user-modal-content');
  modalContent.innerHTML = `
    <div class="user-detail-row">
      <div class="user-detail-label">Full Name:</div>
      <div class="user-detail-value">${user.full_name || 'N/A'}</div>
    </div>
    <div class="user-detail-row">
      <div class="user-detail-label">Email:</div>
      <div class="user-detail-value">${user.email || 'N/A'}</div>
    </div>
    <div class="user-detail-row">
      <div class="user-detail-label">Phone:</div>
      <div class="user-detail-value">${user.phone_number || 'N/A'}</div>
    </div>
    <div class="user-detail-row">
      <div class="user-detail-label">Role:</div>
      <div class="user-detail-value">${user.role || 'User'}</div>
    </div>
    <div class="user-detail-row">
      <div class="user-detail-label">Company:</div>
      <div class="user-detail-value">${user.company || 'N/A'}</div>
    </div>
    <div class="user-detail-row">
      <div class="user-detail-label">Status:</div>
      <div class="user-detail-value"><span class="status-badge status-${user.status || 'active'}">${user.status || 'Active'}</span></div>
    </div>
    <div class="user-detail-row">
      <div class="user-detail-label">Joined:</div>
      <div class="user-detail-value">${new Date(user.created_at).toLocaleDateString()}</div>
    </div>
  `;
  
  document.getElementById('user-modal').style.display = 'block';
}

function closeUserModal() {
  document.getElementById('user-modal').style.display = 'none';
}

// Action Functions with real API calls
async function editUser(userId) {
  // For now, redirect to a user edit page or open modal
  window.location.href = `/pages/admin-edit-user.html?id=${userId}`;
}

async function deleteUser(userId) {
  if (confirm('Are you sure you want to delete this user?')) {
    try {
      const token = localStorage.getItem('token') || sessionStorage.getItem('token');
      const response = await fetch(`${API_BASE_URL}/api/admin/users/${userId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (response.ok) {
        alert('User deleted successfully');
        loadUsers(); // Reload the users list
      } else {
        alert('Failed to delete user');
      }
    } catch (error) {
      console.error('Error deleting user:', error);
      alert('Error deleting user');
    }
  }
}

async function viewProperty(propertyId) {
  window.open(`/pages/propertytemplate.html?id=${propertyId}`, '_blank');
}

async function editProperty(propertyId) {
  window.location.href = `/pages/admin-edit-property.html?id=${propertyId}`;
}

async function deleteProperty(propertyId) {
  if (confirm('Are you sure you want to delete this property?')) {
    try {
      const token = localStorage.getItem('token') || sessionStorage.getItem('token');
      const response = await fetch(`${API_BASE_URL}/api/admin/properties/${propertyId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (response.ok) {
        alert('Property deleted successfully');
        loadProperties();
      } else {
        alert('Failed to delete property');
      }
    } catch (error) {
      console.error('Error deleting property:', error);
      alert('Error deleting property');
    }
  }
}

async function approveProperty(propertyId) {
  if (confirm('Are you sure you want to approve this property?')) {
    try {
      const token = localStorage.getItem('token') || sessionStorage.getItem('token');
      const response = await fetch(`${API_BASE_URL}/api/admin/properties/${propertyId}/approve`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (response.ok) {
        alert('Property approved successfully');
        loadPendingProperties();
        loadStats(); // Refresh stats
      } else {
        alert('Failed to approve property');
      }
    } catch (error) {
      console.error('Error approving property:', error);
      alert('Error approving property');
    }
  }
}

async function rejectProperty(propertyId) {
  if (confirm('Are you sure you want to reject this property?')) {
    const reason = prompt('Please provide a reason for rejection:');
    if (reason) {
      try {
        const token = localStorage.getItem('token') || sessionStorage.getItem('token');
        const response = await fetch(`${API_BASE_URL}/api/admin/properties/${propertyId}/reject`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ reason })
        });
        
        if (response.ok) {
          alert('Property rejected successfully');
          loadPendingProperties();
          loadStats();
        } else {
          alert('Failed to reject property');
        }
      } catch (error) {
        console.error('Error rejecting property:', error);
        alert('Error rejecting property');
      }
    }
  }
}

async function viewService(serviceId) {
  window.open(`/pages/service-details.html?id=${serviceId}`, '_blank');
}

async function editService(serviceId) {
  window.location.href = `/pages/admin-edit-service.html?id=${serviceId}`;
}

async function deleteService(serviceId) {
  if (confirm('Are you sure you want to delete this service?')) {
    try {
      const token = localStorage.getItem('token') || sessionStorage.getItem('token');
      const response = await fetch(`${API_BASE_URL}/api/admin/services/${serviceId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (response.ok) {
        alert('Service deleted successfully');
        loadServices();
      } else {
        alert('Failed to delete service');
      }
    } catch (error) {
      console.error('Error deleting service:', error);
      alert('Error deleting service');
    }
  }
}

async function approveService(serviceId) {
  if (confirm('Are you sure you want to approve this service?')) {
    try {
      const token = localStorage.getItem('token') || sessionStorage.getItem('token');
      const response = await fetch(`${API_BASE_URL}/api/admin/services/${serviceId}/approve`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (response.ok) {
        alert('Service approved successfully');
        loadPendingServices();
        loadStats();
      } else {
        alert('Failed to approve service');
      }
    } catch (error) {
      console.error('Error approving service:', error);
      alert('Error approving service');
    }
  }
}

async function rejectService(serviceId) {
  if (confirm('Are you sure you want to reject this service?')) {
    const reason = prompt('Please provide a reason for rejection:');
    if (reason) {
      try {
        const token = localStorage.getItem('token') || sessionStorage.getItem('token');
        const response = await fetch(`${API_BASE_URL}/api/admin/services/${serviceId}/reject`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ reason })
        });
        
        if (response.ok) {
          alert('Service rejected successfully');
          loadPendingServices();
          loadStats();
        } else {
          alert('Failed to reject service');
        }
      } catch (error) {
        console.error('Error rejecting service:', error);
        alert('Error rejecting service');
      }
    }
  }
}

async function viewAd(adId) {
  window.open(`/pages/ad-details.html?id=${adId}`, '_blank');
}

async function editAd(adId) {
  window.location.href = `/pages/admin-edit-ad.html?id=${adId}`;
}

async function deleteAd(adId) {
  if (confirm('Are you sure you want to delete this advertisement?')) {
    try {
      const token = localStorage.getItem('token') || sessionStorage.getItem('token');
      const response = await fetch(`${API_BASE_URL}/api/admin/advertisements/${adId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (response.ok) {
        alert('Advertisement deleted successfully');
        loadAdvertisements();
      } else {
        alert('Failed to delete advertisement');
      }
    } catch (error) {
      console.error('Error deleting advertisement:', error);
      alert('Error deleting advertisement');
    }
  }
}

async function approveAd(adId) {
  if (confirm('Are you sure you want to approve this advertisement?')) {
    try {
      const token = localStorage.getItem('token') || sessionStorage.getItem('token');
      const response = await fetch(`${API_BASE_URL}/api/admin/advertisements/${adId}/approve`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (response.ok) {
        alert('Advertisement approved successfully');
        loadPendingAds();
        loadAdvertisements(); // <-- reload active ads tab
        loadStats();
      } else {
        alert('Failed to approve advertisement');
      }
    } catch (error) {
      console.error('Error approving advertisement:', error);
      alert('Error approving advertisement');
    }
  }
}

async function rejectAd(adId) {
  if (confirm('Are you sure you want to reject this advertisement?')) {
    const reason = prompt('Please provide a reason for rejection:');
    if (reason) {
      try {
        const token = localStorage.getItem('token') || sessionStorage.getItem('token');
        const response = await fetch(`${API_BASE_URL}/api/admin/advertisements/${adId}/reject`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ reason })
        });
        
        if (response.ok) {
          alert('Advertisement rejected successfully');
          loadPendingAds();
          loadStats();
        } else {
          alert('Failed to reject advertisement');
        }
      } catch (error) {
        console.error('Error rejecting advertisement:', error);
        alert('Error rejecting advertisement');
      }
    }
  }
}

// Search and Filter Functions
document.addEventListener('DOMContentLoaded', function() {
  // Users search
  document.getElementById('users-search').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const filtered = allUsers.filter(user => 
      (user.full_name && user.full_name.toLowerCase().includes(searchTerm)) ||
      (user.email && user.email.toLowerCase().includes(searchTerm)) ||
      (user.company && user.company.toLowerCase().includes(searchTerm))
    );
    renderUsers(filtered);
  });
  
  // Users filter
  document.getElementById('users-filter').addEventListener('change', function(e) {
    const filterValue = e.target.value;
    const filtered = filterValue ? allUsers.filter(user => user.role === filterValue) : allUsers;
    renderUsers(filtered);
  });
  
  // Similar search/filter for other tabs...
  
  // Initialize
  updateNavigation();
  loadStats();
  loadUsers(); // Load initial tab
});

// Update navigation on page load
document.addEventListener('DOMContentLoaded', updateNavigation);

// Listen for storage changes (when user logs in/out on another page)
window.addEventListener('storage', function(e) {
  if (e.key === 'token') {
    updateNavigation();
  }
});

// Listen for custom events
window.addEventListener('userLoggedIn', updateNavigation);
window.addEventListener('userLoggedOut', updateNavigation);

// Close modal when clicking outside
window.addEventListener('click', function(event) {
  const modal = document.getElementById('user-modal');
  if (event.target === modal) {
    closeUserModal();
  }
});
</script>

<script src="/scripts/chatbot.js"></script>
</body>
</html>
