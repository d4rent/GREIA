<!-- Exposure Packages Partial: profile-exposure.html -->
<div class="profile-section" id="section-exposure-packages">
  <h2>Exposure Packages</h2>
  <div style="background: #e8f4fd; border: 1px solid #bee5eb; border-radius: 6px; padding: 12px; margin-bottom: 20px; font-size: 14px;">
    ðŸš€ <strong>Boost your listing visibility!</strong> Select an exposure package below to feature your property or advertisement more prominently on D4Rent.ie.
  </div>
  <form id="exposure-package-form">
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
      <label style="background:#fff; border:2px solid #a259d9; border-radius:10px; min-width:220px; min-height:220px; height:220px; display:flex; flex-direction:column; justify-content:center; align-items:flex-start; padding:24px; cursor:pointer; position:relative;">
        <input type="radio" name="package_type" value="platinum" style="position:absolute;top:16px;right:16px;transform:scale(1.3);" required>
        <div style="display:flex;align-items:center;margin-bottom:8px;"></div>
        <div style="font-size:1.3em;font-weight:800;color:#a259d9;">â‚¬299.99</div>
        <div style="margin-bottom:8px;">Subscriptions</div>
        <div style="font-size:0.98em;color:#555;">Created: 18 Jul</div>
      </label>
      <label style="background:#fff; border:2px solid #ffd700; border-radius:10px; min-width:220px; min-height:220px; height:220px; display:flex; flex-direction:column; justify-content:center; align-items:flex-start; padding:24px; cursor:pointer; position:relative;">
        <input type="radio" name="package_type" value="gold" style="position:absolute;top:16px;right:16px;transform:scale(1.3);">
        <div style="display:flex;align-items:center;margin-bottom:8px;"></div>
        <div style="font-size:1.3em;font-weight:800;color:#ffd700;">â‚¬149.99</div>
        <div style="margin-bottom:8px;">Subscriptions</div>
        <div style="font-size:0.98em;color:#555;">Created: 18 Jul</div>
      </label>
      <label style="background:#fff; border:2px solid #c0c0c0; border-radius:10px; min-width:220px; min-height:220px; height:220px; display:flex; flex-direction:column; justify-content:center; align-items:flex-start; padding:24px; cursor:pointer; position:relative;">
        <input type="radio" name="package_type" value="silver" style="position:absolute;top:16px;right:16px;transform:scale(1.3);">
        <div style="display:flex;align-items:center;margin-bottom:8px;"></div>
        <div style="font-size:1.3em;font-weight:800;color:#c0c0c0;">â‚¬99.99</div>
        <div style="margin-bottom:8px;">Subscriptions</div>
        <div style="font-size:0.98em;color:#555;">Created: 18 Jul</div>
      </label>
    </div>
    <div style="display: flex; gap: 12px; margin-top: 16px;">
      <button type="submit" style="background: #1c0bff; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; text-decoration: none; display: inline-block;">Purchase Exposure Package</button>
    </div>
  </form>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const exposureForm = document.getElementById('exposure-package-form');
  if (exposureForm) {
    exposureForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(exposureForm);
      const packageType = formData.get('package_type');
      const duration = formData.get('duration');
      const listingId = formData.get('listing_id');
      // Step 1: Save exposure package request (optional, if backend requires)
      let exposureRes;
      try {
        exposureRes = await fetch('/api/exposure', {
          credentials: 'include'
        });
      } catch (err) {
        alert('Failed to save exposure package request.');
        return;
      }
      if (!exposureRes.ok) {
        alert('Failed to save exposure package request.');
        return;
      }
      const exposureData = await exposureRes.json();
      // Step 2: Request Stripe Checkout session
      let stripeRes;
      try {
        stripeRes = await fetch('/api/payments/create-checkout-session', {
          body: JSON.stringify({ productType: 'exposure', option: packageType, duration, listingId, exposureId: exposureData.id })
        });
      } catch (err) {
        alert('Failed to start payment.');
        return;
      }
      if (!stripeRes.ok) {
        alert('Failed to start payment.');
        return;
      }
      const stripeData = await stripeRes.json();
      if (stripeData.url) {
        window.location.href = stripeData.url;
      } else {
        alert('Payment link not received.');
      }
    });
  }
});
</script>
