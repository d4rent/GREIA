
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Agent Profile - Greia</title>
<link rel="icon" type="image/png" href="../assets/greia (4).png"/>
<link href="../css/global-nav.css" rel="stylesheet"/>
<link href="../css/main.css" rel="stylesheet"/>
<script src="/scripts/main.js"></script>
<style>
/* Blue Navigation Bar Styling */
.navbar {
  background: #1c0bff !important;
  box-shadow: 0 2px 10px rgba(28, 11, 255, 0.3);
}

.navbar .nav-links a {
  color: white !important;
}

.navbar .nav-links a:hover {
  color: rgb(78, 255, 146) !important;
}

.navbar .dropdown-menu {
  background: white;
  border: 1px solid #1c0bff;
}

.navbar .dropdown-menu a {
  color: #333 !important;
}

.navbar .dropdown-menu a:hover {
  background: #f0f8ff;
  color: #1c0bff !important;
}

/* Keep Connect link green */
.navbar .nav-links a[style*="rgb(78, 255, 146)"] {
  color: rgb(78, 255, 146) !important;
}

/* Mobile nav styling */
.mobile-nav {
  background: #1c0bff !important;
}

.mobile-nav a {
  color: white !important;
}

.mobile-nav a:hover {
  color: rgb(78, 255, 146) !important;
}

body {
  background: linear-gradient(135deg, #f8fafc 0%, #e9ecef 100%);
  font-family: 'San Francisco', 'Segoe UI', 'Roboto', Arial, sans-serif;
  margin: 0;
  padding: 0;
}

.profile-main-container {
  max-width: 1200px;
  margin: 40px auto;
  padding: 0 20px;
}

/* Use the same agent card style as agents.html for profile header */
.profile-header-card {
  background: rgba(255,255,255,0.95);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(28,11,255,0.1);
  padding: 40px;
  margin-bottom: 30px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
}

.user-card-style {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  padding: 1.2em 1em;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  min-height: 280px;
}

.user-photo {
  width: 150px;
  height: 150px;
  object-fit: cover;
  border-radius: 50%;
  border: 3px solid #00ff5e8f;
  background: #f4f4f4;
  display: block;
  margin-bottom: 1em;
}

.agent-name {
  font-weight: 700;
  font-size: 2.5em;
  margin-bottom: 0.2em;
  color: #1c0bff;
  text-align: center;
}

.agent-role {
  font-size: 1.3em;
  color: #00ff4c;
  font-weight: 600;
  margin-bottom: 0.5em;
  text-align: center;
}

.agent-company {
  font-size: 1.1em;
  color: #1c0bff;
  margin: 0 0 10px 0;
  font-weight: 600;
  text-align: center;
}

.profile-header-content {
  display: flex;
  align-items: center;
  gap: 30px;
  margin-bottom: 30px;
}

.profile-picture {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid #e9ecef;
  box-shadow: 0 4px 20px rgba(28,11,255,0.15);
}

.profile-info {
  flex: 1;
}

.profile-name {
  font-size: 2.5em;
  font-weight: 700;
  color: #1c0bff;
  margin: 0 0 10px 0;
}

.profile-role {
  font-size: 1.3em;
  color: #666;
  margin: 0 0 15px 0;
  font-weight: 500;
}

.profile-company {
  font-size: 1.1em;
  color: #1c0bff;
  margin: 0 0 10px 0;
  font-weight: 600;
}

.profile-contact {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-top: 15px;
}

.contact-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 1em;
  color: #555;
}

.contact-icon {
  font-size: 1.2em;
}

.profile-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 30px;
}

.stat-card {
  background: rgba(28,11,255,0.05);
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  border: 1px solid rgba(28,11,255,0.1);
}

.stat-number {
  font-size: 2.2em;
  font-weight: 700;
  color: #1c0bff;
  margin: 0;
}

.stat-label {
  font-size: 1em;
  color: #666;
  margin: 5px 0 0 0;
  font-weight: 500;
}

.content-section {
  background: rgba(255,255,255,0.95);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(28,11,255,0.1);
  padding: 30px;
  margin-bottom: 30px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
}

.section-title {
  font-size: 1.8em;
  font-weight: 700;
  color: #1c0bff;
  margin: 0 0 20px 0;
  padding-bottom: 10px;
  border-bottom: 2px solid #e9ecef;
}

.properties-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

/* Use the same property card style as rent.html */
.modern-property-card {
  position: relative;
  background: #fff;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
}

.modern-property-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(28,11,255,0.15);
}

.modern-property-card .property-image {
  width: 100%;
  height: 200px;
  object-fit: cover;
}

.modern-property-card .property-details {
  padding: 20px;
}

.modern-property-card .property-title {
  font-size: 1.2em;
  font-weight: 600;
  color: #333;
  margin: 0 0 10px 0;
}

.modern-property-card .property-address {
  font-size: 0.95em;
  color: #666;
  margin: 5px 0;
}

.modern-property-card .property-details-info {
  font-size: 0.95em;
  color: #666;
  margin: 5px 0;
}

.modern-property-card .property-price {
  font-size: 1.3em;
  font-weight: 700;
  color: #1c0bff;
  margin: 15px 0 0 0;
}

.modern-property-card .view-property-btn {
  display: inline-block;
  background: rgb(78, 255, 146);
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  text-decoration: none;
  font-weight: 600;
  margin-top: 10px;
  transition: background 0.3s ease;
}

.modern-property-card .view-property-btn:hover {
  background: rgb(60, 200, 120);
}

/* Use the same service card style as services.html */
.services-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.service-card {
  background: #fff;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  display: flex;
  flex-direction: column;
}

.service-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(28,11,255,0.15);
}

.service-card .service-image-container {
  height: 200px;
  overflow: hidden;
}

.service-card .service-profile-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.service-card .service-info {
  padding: 20px;
  flex: 1;
}

.service-card .service-title {
  font-size: 1.2em;
  font-weight: 600;
  color: #333;
  margin: 0 0 10px 0;
}

.service-card .service-description {
  font-size: 0.95em;
  color: #666;
  margin: 5px 0;
  line-height: 1.4;
}

.service-card .service-price {
  font-size: 1.1em;
  font-weight: 600;
  color: #1c0bff;
  margin: 10px 0 0 0;
}

.bio-text {
  font-size: 1.1em;
  line-height: 1.6;
  color: #555;
  background: #f8fafc;
  padding: 20px;
  border-radius: 12px;
  border-left: 4px solid #1c0bff;
}

.loading {
  text-align: center;
  padding: 60px 20px;
  color: #666;
  font-size: 1.2em;
}

.error {
  text-align: center;
  padding: 60px 20px;
  color: #dc3545;
  font-size: 1.1em;
  background: #fee2e2;
  border-radius: 12px;
  border: 1px solid #fecaca;
}

@media (max-width: 768px) {
  .profile-header-content {
    flex-direction: column;
    text-align: center;
  }
  
  .profile-contact {
    justify-content: center;
  }
  
  .profile-stats {
    grid-template-columns: 1fr 1fr;
  }
  
  .properties-grid {
    grid-template-columns: 1fr;
  }
  
  .profile-main-container {
    margin: 20px auto;
    padding: 0 10px;
  }
  
  .profile-header-card,
  .content-section {
    padding: 20px;
  }
}
</style>
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar">
  <div class="navbar-thirds">
    <div class="navbar-third left">
      <ul class="nav-links left-links" style="position:relative; z-index:100;">
        <li class="dropdown" style="position:relative;">
          <a href="/pages/buy.html" style="position:relative; z-index:101;">Property</a>
          <ul class="dropdown-menu" style="top:100%; left:0; margin-top:0; padding-top:0; border-top:0;">
            <li><a href="/pages/buy.html">Buy</a></li>
            <li><a href="/pages/rent.html">Rent</a></li>
            <li><a href="/pages/commercial.html">Commercial</a></li>
            <li><a href="/pages/buy.html">Apartments</a></li>
            <li><a href="/pages/sell.html">Sell</a></li>
            <li><a href="/pages/valuations.html">Valuations</a></li>
            <li><a href="/pages/buy.html">New Homes</a></li>
          </ul>
        </li>
        <li class="dropdown" style="position:relative;">
          <a href="/pages/agents.html" style="color: rgb(78, 255, 146); position:relative; z-index:101;" class="referral-dropdown-toggle">Connect</a>
          <ul class="dropdown-menu" style="top:100%; left:0; margin-top:0; padding-top:0; border-top:0;">
            <li><a href="/pages/agents.html">Find an Agent</a></li>
            <li class="nested-dropdown" style="position: relative;">
              <a href="/pages/agents.html" class="referral-dropdown-toggle" tabindex="0" aria-haspopup="true" aria-expanded="false">Referral Agents ▸</a>
              <ul class="dropdown-menu referral-dropdown" style="display:none; position: absolute; left: 100%; top: 0; background: white; list-style:none; padding:10px; border:1px solid #ccc; min-width: 220px; z-index: 2000;">
                <li><a href="/pages/agents.html?subtype=luxury">Luxury Home Agents</a></li>
                <li><a href="/pages/agents.html?subtype=lettings">Lettings Agents</a></li>
                <li><a href="/pages/agents.html?subtype=newhomes">New Homes Agents</a></li>
                <li><a href="/pages/agents.html?subtype=commercial">Commercial Agents</a></li>
                <li><a href="/pages/agents.html?subtype=residential">Residential Agents</a></li>
                <li><a href="/pages/agents.html?subtype=developer">Developer Agents</a></li>
                <li><a href="/pages/agents.html?subtype=timeshare">Timeshare Agents</a></li>
              </ul>
            </li>
            <li><a href="/pages/coaching.html">Coaching</a></li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="navbar-third center">
      <div class="logo">
        <a href="/index.html">
          <img alt="Logo" src="../assets/greia (4).png" style="height: auto; max-height: 140px;"/>
        </a>
      </div>
    </div>
    <div class="navbar-third right">
      <ul class="nav-links right-links">
        <li>
          <a href="/pages/services.html" class="fancy-underline">Our Services</a>
        </li>
        <li>
          <a href="/pages/concierge.html" class="fancy-underline">Concierge</a>
        </li>
        <li class="dropdown" id="auth-menu">
          <a href="/pages/login.html" id="login-btn">Log In</a>
          <ul class="dropdown-menu" id="login-dropdown">
            <li><a href="/pages/login.html">Sign In</a></li>
            <li><a href="/pages/register.html">Register</a></li>
            <li><a href="/pages/forgot-password.html">Forgot Password?</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
  <button aria-label="Toggle navigation" class="hamburger-menu">
    <span></span>
    <span></span>
    <span></span>
  </button>
  <!-- Mobile nav menu -->
  <div class="mobile-nav-overlay"></div>
  <div class="mobile-nav">
    <ul>
      <li class="dropdown">
        <a href="/pages/buy.html" class="dropdown-toggle">Property</a>
        <ul class="dropdown-menu">
          <li><a href="/pages/buy.html">Buy</a></li>
          <li><a href="/pages/rent.html">Rent</a></li>
          <li><a href="/pages/commercial.html">Commercial</a></li>
          <li><a href="/pages/buy.html">Apartments</a></li>
          <li><a href="/pages/sell.html">Sell</a></li>
          <li><a href="/pages/valuations.html">Valuations</a></li>
          <li><a href="/pages/buy.html">New Homes</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="/pages/agents.html" class="dropdown-toggle" style="color: rgb(78, 255, 146);">Connect</a>
        <ul class="dropdown-menu">
          <li><a href="/pages/agents.html">Find an Agent</a></li>
          <li><a href="/pages/agents.html">Referral Agents</a></li>
          <li><a href="/pages/coaching.html">Coaching</a></li>
        </ul>
      </li>
      <li><a href="/pages/services.html">Our Services</a></li>
      <li><a href="/pages/concierge.html">Concierge</a></li>
      <li class="dropdown" id="mobile-auth-menu">
        <a href="/pages/login.html" class="dropdown-toggle" id="mobile-login-btn">Log In</a>
        <ul class="dropdown-menu" id="mobile-login-dropdown">
          <li><a href="/pages/login.html">Sign In</a></li>
          <li><a href="/pages/register.html">Register</a></li>
          <li><a href="/pages/forgot-password.html">Forgot Password?</a></li>
        </ul>
      </li>
    </ul>
  </div>
</nav>

<!-- Main Content -->
<div class="profile-main-container" id="profile-container">
  <div class="loading">Loading agent profile...</div>
</div>

<!-- Footer -->


<!-- Scripts -->
<script>
// Check if global nav JS exists, if not provide fallback
try {
  // Try to load global nav functions
  if (typeof initializeGlobalNavigation !== 'function') {
    console.warn('Global navigation JS not loaded, using fallback');
    window.initializeGlobalNavigation = function() {
      // Basic mobile menu toggle
      const hamburger = document.querySelector('.hamburger-menu');
      const mobileNav = document.querySelector('.mobile-nav');
      const overlay = document.querySelector('.mobile-nav-overlay');
      
      if (hamburger && mobileNav) {
        hamburger.addEventListener('click', function() {
          mobileNav.classList.toggle('active');
          overlay.classList.toggle('active');
        });
        
        overlay.addEventListener('click', function() {
          mobileNav.classList.remove('active');
          overlay.classList.remove('active');
        });
      }
    };
  }
} catch (e) {
  console.warn('Error loading global navigation:', e);
}
</script>
<script src="../js/global-nav.js" onerror="console.warn('global-nav.js not found')"></script>
<script src="../js/global-search.js" onerror="console.warn('global-search.js not found')"></script>
<script>
// Ensure API_BASE_URL is defined
if (typeof API_BASE_URL === 'undefined' || !API_BASE_URL) {
  if (window.API_BASE_URL && typeof window.API_BASE_URL === 'string') {
    var API_BASE_URL = window.API_BASE_URL;
    console.log('API_BASE_URL loaded from window:', API_BASE_URL);
  } else if (typeof window !== 'undefined' && window.API_BASE_URL) {
    var API_BASE_URL = window.API_BASE_URL;
    console.log('API_BASE_URL loaded from window (fallback):', API_BASE_URL);
  } else {
    var API_BASE_URL = '';
    console.error('API_BASE_URL is not defined. Check main.js or global variable.');
  }
}

function isUserLoggedIn() {
  return localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
}

function updateNavigation() {
  // ...existing code...
}

function getProfilePicUrl(profilePicture) {
  if (!profilePicture) {
    return '../assets/blank-profile-picture-973460_960_720.webp';
  }
  // If already a full URL, use it directly
  if (profilePicture.startsWith('http://') || profilePicture.startsWith('https://')) {
    return profilePicture;
  }
  // Otherwise, assume it's a filename or relative path from the API
  return `${API_BASE_URL}/uploads/${profilePicture}`;
}

function getPropertyImageUrl(image) {
  if (!image) {
    return '../assets/placeholder-image.webp';
  }
  // If already a full URL, use it directly
  if (image.startsWith('http://') || image.startsWith('https://')) {
    return image;
  }
  // Otherwise, assume it's a filename or relative path from the API
  return `${API_BASE_URL}/uploads/${image}`;
}

async function loadAgentProfile() {
  const urlParams = new URLSearchParams(window.location.search);
  const agentId = urlParams.get('id');
  const container = document.getElementById('profile-container');

  if (!API_BASE_URL) {
    container.innerHTML = '<div class="error">API_BASE_URL is not defined. Please check your configuration or contact support.</div>';
    return;
  }

  if (!agentId) {
    container.innerHTML = '<div class="error">No agent ID specified. Please select an agent to view their profile.</div>';
    return;
  }

  console.log('Loading agent profile for ID:', agentId);

  try {
    let agent = null;
    let properties = [];
    let services = [];

    try {
      const response = await fetch(`${API_BASE_URL}/api/users/${agentId}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      if (response.ok) {
        agent = await response.json();
        console.log('Agent data loaded:', agent);
      } else {
        container.innerHTML = `<div class="error">Agent not found (API returned ${response.status}).</div>`;
        return;
      }
    } catch (apiError) {
      container.innerHTML = `<div class="error">Failed to fetch agent data. Please try again later.<br>${apiError}</div>`;
      return;
    }

    if (!agent) {
      container.innerHTML = `<div class="error">Agent not found. Please check the link or try again later.</div>`;
      return;
    }

    try {
      const propertiesResponse = await fetch(`${API_BASE_URL}/api/properties?user=${agentId}&approved=1`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      if (propertiesResponse.ok) {
        properties = await propertiesResponse.json();
        // Debug log raw properties
        console.log('Raw properties from API:', properties);
        // Robust filter: handle approved as string/number, user as string/number, and fallback to agent_id
        properties = properties.filter(prop => {
          const approved = prop.approved === 1 || prop.approved === '1' || prop.status === 'approved';
          const userMatch = String(prop.user) === String(agentId) || String(prop.agent_id) === String(agentId);
          return approved && userMatch;
        });
        console.log('Filtered properties for agent:', properties);
      } else {
        console.warn('Properties API returned:', propertiesResponse.status);
      }
    } catch (propError) {
      console.warn('Failed to load properties:', propError);
    }

    try {
      const servicesResponse = await fetch(`${API_BASE_URL}/api/services?user=${agentId}&approved=1`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      if (servicesResponse.ok) {
        services = await servicesResponse.json();
        services = services.filter(service => service.approved === 1 && String(service.user) === String(agentId));
      } else {
        console.warn('Services API returned:', servicesResponse.status);
      }
    } catch (serviceError) {
      console.warn('Failed to load services:', serviceError);
    }

    renderAgentProfile(agent, properties, services);
    document.title = `${agent.full_name || 'Agent'} - D4Rent`;
  } catch (error) {
    container.innerHTML = `
      <div class="error">
        <h3>Error loading agent profile</h3>
        <p>Agent ID: ${agentId}</p>
        <p>The agent profile could not be loaded. This could be because:</p>
        <ul style="text-align: left; margin: 20px 0;">
          <li>The agent doesn't exist in the database</li>
          <li>The backend server is not running</li>
          <li>There's a network connectivity issue</li>
        </ul>
        <p><a href="/pages/agents.html" style="color: #1c0bff;">← Back to Agents</a></p>
      </div>
    `;
  }
}

// Render agent profile
function renderAgentProfile(agent, properties, services) {
  const container = document.getElementById('profile-container');
  // Only show fetched data, never fallback/demo for stat boxes or profile photo
  if (!agent || !agent.id) {
    container.innerHTML = `<div class="error">Agent not found.</div>`;
    return;
  }
  const statExperience = agent.experience_years !== undefined ? agent.experience_years : '';
  const statSales = agent.completed_sales !== undefined ? agent.completed_sales : '';
  const statProperties = Array.isArray(properties) ? properties.length : 0;
  const statServices = Array.isArray(services) ? services.length : 0;
  const profilePhoto = agent.profile_picture ? getProfilePicUrl(agent.profile_picture) : '../assets/blank-profile-picture-973460_960_720.webp';

  const profileHtml = `
    <!-- Profile Header -->
    <div class="profile-header-card">
      <div class="profile-header-content">
        <img src="${profilePhoto}" alt="${agent.full_name || 'Agent'}" class="profile-picture">
        <div class="profile-info">
          <h1 class="profile-name">${agent.full_name || ''}</h1>
          <div class="profile-role">${agent.role || ''}</div>
          ${agent.company ? `<div class="profile-company">${agent.company}</div>` : ''}
          ${agent.profession ? `<div class="profile-company">${agent.profession}</div>` : ''}
          <div class="profile-contact">
            ${agent.email ? `<div class="contact-item"><span class="contact-icon">📧</span><a href="mailto:${agent.email}">${agent.email}</a></div>` : ''}
            ${agent.phone_number ? `<div class="contact-item"><span class="contact-icon">📞</span><a href="tel:${agent.phone_number}">${agent.phone_number}</a></div>` : ''}
          </div>
        </div>
      </div>
      <!-- Statistics -->
      <div class="profile-stats">
        <div class="stat-card">
          <div class="stat-number">${statProperties}</div>
          <div class="stat-label">Active Properties</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${statServices}</div>
          <div class="stat-label">Services Offered</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${statExperience}</div>
          <div class="stat-label">Years Experience</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${statSales}</div>
          <div class="stat-label">Completed Sales</div>
        </div>
      </div>
    </div>

    ${agent.bio ? `
    <!-- Bio Section -->
    <div class="content-section">
      <h2 class="section-title">About ${agent.full_name?.split(' ')[0] || ''}</h2>
      <div class="bio-text">${agent.bio}</div>
    </div>
    ` : ''}

    ${Array.isArray(properties) && properties.length > 0 ? `
    <!-- Properties Section -->
    <div class="content-section">
      <h2 class="section-title">Current Listings</h2>
      <div class="properties-grid">
        ${properties.map(property => `
          <div class="modern-property-card" onclick="window.open('/pages/propertytemplateRENT.html?id=${property.id}', '_blank')">
            <img src="${getPropertyImageUrl(property.main_image || property.image)}" alt="${property.title}" class="property-image">
            <div class="property-details">
              <div class="property-title">${property.title || ''}</div>
              <div class="property-address">${property.address || ''}</div>
              <div class="property-details-info">${property.bedrooms ? property.bedrooms + ' bed' : ''} ${property.property_type || ''}</div>
              <div class="property-price">${property.price ? '€' + property.price.toLocaleString() : ''}</div>
              <a href="/pages/propertytemplateRENT.html?id=${property.id}" class="view-property-btn">View Property</a>
            </div>
          </div>
        `).join('')}
      </div>
    </div>
    ` : ''}

    ${Array.isArray(services) && services.length > 0 ? `
    <!-- Services Section -->
    <div class="content-section">
      <h2 class="section-title">Services Offered</h2>
      <div class="services-grid">
        ${services.map(service => `
          <div class="service-card">
            <div class="service-image-container">
              <img src="${service.photo ? getPropertyImageUrl(service.photo) : '../assets/placeholder-service.png'}" alt="${service.title || 'Service'}" class="service-profile-img">
            </div>
            <div class="service-info">
              <div class="service-title">${service.title || service.name || ''}</div>
              ${service.description ? `<div class="service-description">${service.description}</div>` : ''}
              ${service.price_range ? `<div class="service-price">${service.price_range}</div>` : ''}
            </div>
          </div>
        `).join('')}
      </div>
    </div>
    ` : ''}

    ${(Array.isArray(properties) && properties.length === 0) && (Array.isArray(services) && services.length === 0) ? `
    <div class="content-section">
      <div style="text-align: center; color: #666; padding: 40px;">
        <h3>No Active Listings</h3>
        <p>This agent doesn't currently have any active property listings or services.</p>
      </div>
    </div>
    ` : ''}
  `;
  container.innerHTML = profileHtml;
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
  updateNavigation();
  loadAgentProfile();
  
  // Listen for auth changes
  window.addEventListener('storage', function(e) {
    if (e.key === 'authToken') {
      updateNavigation();
    }
  });
});
</script>
<script src="/scripts/chatbot.js"></script>
<div data-include="/components/footer.html"></div>
<script src="/public/js/greia-auto-mount.js"></script>
<script src="/scripts/includes.js"></script>
</body>
</html>
