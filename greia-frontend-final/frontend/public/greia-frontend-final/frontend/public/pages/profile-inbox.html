<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Inbox - Profile - Greia</title>
<link rel="icon" type="image/png" href="../assets/greia (4).png"/>
<link href="../css/profile.css" rel="stylesheet"/>
<link href="../css/profile-nav.css" rel="stylesheet"/>
<link href="../css/main.css" rel="stylesheet"/>
<link href="../css/global-nav.css" rel="stylesheet"/>
<link href="../css/footer.css" rel="stylesheet"/>
<script src="../scripts/main.js"></script>
<style>
/* Inbox specific styles */
.inbox-tabs {
  display: flex;
  gap: 16px;
  margin-bottom: 24px;
  border-bottom: 2px solid #eee;
  padding-bottom: 12px;
}

.inbox-tab {
  padding: 8px 16px;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.3s ease;
  color: #666;
}

.inbox-tab:hover {
  background: rgba(28,11,255,0.05);
  color: #1c0bff;
}

.inbox-tab.active {
  background: rgba(28,11,255,0.1);
  color: #1c0bff;
  font-weight: 500;
}

.inbox-counter {
  background: #00ffa2;
  color: black;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  margin-left: 6px;
}

.message-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.message-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  transition: all 0.3s ease;
  border: 1px solid rgba(28,11,255,0.1);
  margin-bottom: 16px;
}

.message-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.12);
  border-color: rgba(28,11,255,0.2);
}

.message-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.message-sender {
  font-weight: 500;
  color: #1c0bff;
}

.message-date {
  color: #666;
  font-size: 14px;
}

.message-subject {
  font-weight: 500;
  margin-bottom: 8px;
}

.message-preview {
  color: #666;
  margin-bottom: 16px;
}

.message-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.message-type {
  background: rgba(28,11,255,0.1);
  color: #1c0bff;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 14px;
}

.message-actions {
  display: flex;
  gap: 8px;
}

.unread {
  position: relative;
}

.unread::before {
  content: '';
  position: absolute;
  left: -8px;
  top: 50%;
  transform: translateY(-50%);
  width: 8px;
  height: 8px;
  background: #00ffa2;
  border-radius: 50%;
}
</style>
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar">
  <div class="navbar-thirds">
    <div class="navbar-third left">
      <ul class="nav-links left-links">
        <li class="dropdown">
          <a href="/pages/buy.html">Property</a>
          <ul class="dropdown-menu">
            <li><a href="/pages/buy.html">Buy</a></li>
            <li><a href="/pages/rent.html">Rent</a></li>
            <li><a href="/pages/commercial.html">Commercial</a></li>
            <li><a href="/pages/buy.html">Apartments</a></li>
            <li><a href="/pages/sell.html">Sell</a></li>
            <li><a href="/pages/valuations.html">Valuations</a></li>
            <li><a href="/pages/buy.html">New Homes</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="/pages/agents.html" style="color: rgb(78, 255, 146);" class="referral-dropdown-toggle">Connect</a>
          <ul class="dropdown-menu">
            <li><a href="/pages/agents.html">Find an Agent</a></li>
            <li><a href="/pages/coaching.html">Coaching</a></li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="navbar-third center">
      <div class="logo">
        <a href="/index.html">
          <img alt="Logo" src="../assets/greia (4).png" style="height: auto; max-height: 140px;"/>
        </a>
      </div>
    </div>
    <div class="navbar-third right">
      <ul class="nav-links right-links">
        <li><a href="/pages/services.html" class="fancy-underline">Our Services</a></li>
        <li><a href="/pages/concierge.html" class="fancy-underline">Concierge</a></li>
        <li class="dropdown" id="auth-menu">
          <a href="/pages/login.html" id="login-btn">Log In</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="profile-flex-layout" style="display: flex; align-items: flex-start; width: 100%; max-width: 1400px; margin: 0 auto; min-height: 80vh;">
  <!-- Sidebar Navigation -->
  <aside class="profile-sidebar" style="margin: 0; min-width: 220px; background: #fff; border-radius: 18px 0 0 18px; box-shadow: 0 4px 24px rgba(0,0,0,0.08); padding: 32px 0; height: 100%; position: relative;">
    <nav class="sidebar-nav" style="display: flex; flex-direction: column; gap: 12px;">
      <a href="./profile.html" class="nav-link" style="display: block; padding: 14px 32px; color: #222; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out;">Profile</a>
      <a href="./profile-properties.html" class="nav-link" style="display: block; padding: 14px 32px; color: #222; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out;">Properties</a>
      <a href="./profile-ads.html" class="nav-link" style="display: block; padding: 14px 32px; color: #222; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out;">Advertisements</a>
      <a href="./profile-services.html" class="nav-link" style="display: block; padding: 14px 32px; color: #222; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out;">Services</a>
      <a href="./profile-inbox.html" class="nav-link active" style="display: block; padding: 14px 32px; color: #1c0bff; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out; background: rgba(28,11,255,0.08); position: relative;">
        <span style="position: relative; z-index: 1;">Inbox</span>
        <span style="content: ''; position: absolute; left: 0; top: 0; height: 100%; width: 4px; background: #1c0bff;"></span>
      </a>
      <a href="./profile-saved.html" class="nav-link" style="display: block; padding: 14px 32px; color: #222; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out;">Saved Items</a>
      <a href="./analytics.html" class="nav-link" style="display: block; padding: 14px 32px; color: #222; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out;">Analytics</a>
      <a href="./profile-subscriptions.html" class="nav-link" style="display: block; padding: 14px 32px; color: #222; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out;">Packages & Memberships</a>
      <a href="./profile-settings.html" class="nav-link" style="display: block; padding: 14px 32px; color: #222; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out;">Settings</a>
      <a href="./admindashboard.html" class="nav-link" id="nav-admin-dashboard" style="display:none; padding: 14px 32px; color: #222; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out;">Admin Dashboard</a>
      <a href="../auth/logout.html" class="nav-link" id="nav-logout" style="display: block; padding: 14px 32px; color: #222; text-decoration: none; font-size: 1.08em; font-weight: 500; letter-spacing: 0.01em; transition: all 0.2s ease-out;">Logout</a>
    </nav>
  </aside>

  <!-- Main Content Area -->
  <section class="profile-content-card" style="flex: 1; background: #fff; border-radius: 0 18px 18px 0; box-shadow: 0 4px 24px rgba(0,0,0,0.08); padding: 40px 32px; min-height: 80vh;">
    <div class="profile-section-content" style="padding-top: 0;">
      <h2 style="margin: 0 0 40px 0; color: #1c0bff; font-size: 24px;">Inbox</h2>

      <!-- Inbox Stats -->
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 0 0 40px 0;">
        <div style="background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <h3 style="margin: 0 0 8px; color: #1c0bff; font-size: 16px;">Unread Messages</h3>
          <div style="font-size: 24px; font-weight: 600;">0</div>
          <div style="color: #666; font-size: 14px; margin-top: 4px;">New Messages</div>
        </div>
        <div style="background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <h3 style="margin: 0 0 8px; color: #1c0bff; font-size: 16px;">Property Inquiries</h3>
          <div style="font-size: 24px; font-weight: 600;">0</div>
          <div style="color: #666; font-size: 14px; margin-top: 4px;">Total Messages</div>
        </div>
        <div style="background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <h3 style="margin: 0 0 8px; color: #1c0bff; font-size: 16px;">Service Inquiries</h3>
          <div style="font-size: 24px; font-weight: 600;">0</div>
          <div style="color: #666; font-size: 14px; margin-top: 4px;">Total Messages</div>
        </div>
      </div>

      <!-- Search & Filters -->
      <div class="search-filter-bar" style="display:flex;align-items:center;gap:12px;margin-bottom:24px;background:#f4f8fc;padding:16px 20px;border-radius:10px;box-shadow:0 2px 8px #e0e7ef;white-space:nowrap;overflow-x:auto;">
        <input type="text" id="message-search" placeholder="ðŸ” Search messages" style="width:200px;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;">
        <select id="message-status" style="width:140px;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;">
          <option value="">All Status</option>
          <option value="unread">Unread</option>
          <option value="read">Read</option>
        </select>
        <input type="date" id="message-date" style="width:140px;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;">
        <button onclick="searchMessages()" style="background:#00ffa2;color:black;border:none;padding:8px 24px;border-radius:6px;cursor:pointer;white-space:nowrap;transition:all 0.4s ease;box-shadow:0 4px 15px rgba(0,255,162,0.4);">Search</button>
      </div>

      <!-- Inbox Tabs -->
      <div class="inbox-tabs" style="background: #fff; border-radius: 12px; padding: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 24px;">
        <div class="inbox-tab active" onclick="showTab('all')" style="font-weight: 500;">All Messages <span class="inbox-counter">0</span></div>
        <div class="inbox-tab" onclick="showTab('property')">Property Inquiries <span class="inbox-counter">0</span></div>
        <div class="inbox-tab" onclick="showTab('service')">Service Inquiries <span class="inbox-counter">0</span></div>
      </div>

      <!-- Message List -->
      <div class="message-list" id="message-list" style="background: #fff; border-radius: 12px; padding: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
        <!-- Messages will be loaded here -->
        <div style="text-align: center; color: #666; padding: 40px;">No messages yet</div>
      </div>
    </div>
  </section>
</div>

<script>
function showTab(tab) {
  // Remove active class from all tabs
  document.querySelectorAll('.inbox-tab').forEach(t => t.classList.remove('active'));
  
  // Add active class to clicked tab
  event.target.closest('.inbox-tab').classList.add('active');
  
  // Load messages for selected tab
  loadMessages(tab);
}

function loadMessages(type = 'all') {
  const messageList = document.getElementById('message-list');
  
  // This is a placeholder - replace with actual API call
  const mockMessages = [
    // Add mock messages here when needed
  ];

  if (mockMessages.length === 0) {
    messageList.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">No messages yet</div>';
    return;
  }

  messageList.innerHTML = mockMessages
    .filter(msg => type === 'all' || msg.type === type)
    .map(msg => `
      <div class="message-card ${msg.unread ? 'unread' : ''}">
        <div class="message-header">
          <span class="message-sender">${msg.sender}</span>
          <span class="message-date">${msg.date}</span>
        </div>
        <div class="message-subject">${msg.subject}</div>
        <div class="message-preview">${msg.preview}</div>
        <div class="message-footer">
          <span class="message-type">${msg.type === 'property' ? 'Property Inquiry' : 'Service Inquiry'}</span>
          <div class="message-actions">
            <button onclick="replyToMessage('${msg.id}')" 
                    style="background: #00ffa2; color: black; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">
              Reply
            </button>
            <button onclick="markAsRead('${msg.id}')" 
                    style="background: #f0f0f0; color: #666; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">
              Mark as Read
            </button>
          </div>
        </div>
      </div>
    `).join('');
}

function replyToMessage(messageId) {
  // Add code to handle message replies
  console.log('Reply to message:', messageId);
}

function markAsRead(messageId) {
  // Add code to mark message as read
  console.log('Mark as read:', messageId);
}

// Load all messages when page loads
document.addEventListener('DOMContentLoaded', () => loadMessages());
</script>

  <!-- Footer -->
  

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<div data-include="/components/footer.html"></div>
<script src="/public/js/greia-auto-mount.js"></script>
<script src="/scripts/includes.js"></script>
</body>
</html>

<script>
async function api(p,opts={}){ const r = await fetch(p,{credentials:'include',headers:{'Content-Type':'application/json'},...opts}); const d = await r.json().catch(()=>({})); if(!r.ok) throw new Error(d.message||('HTTP '+r.status)); return d; }
document.querySelector('[data-make-referral]').addEventListener('click', async ()=>{
  if(!currentThreadId) return alert('Open a thread first');
  const to_user_id = prompt('Referral to user id:');
  if(!to_user_id) return;
  try{ await api('/api/referrals',{method:'POST',body:JSON.stringify({ to_user_id: Number(to_user_id), conversation_id: currentThreadId, note: 'Referral from thread' })}); alert('Referral created'); }catch(e){ alert(e.message); }
});
document.querySelector('[data-send-contract]').addEventListener('click', async ()=>{
  if(!currentThreadId) return alert('Open a thread first');
  const title = prompt('Contract title:');
  if(!title) return;
  try{
    const { id, upload_url } = await api('/api/contracts',{method:'POST',body:JSON.stringify({title})});
    // Ask for PDF file
    const f = await new Promise(resolve=>{
      const inp = document.createElement('input'); inp.type='file'; inp.accept='application/pdf';
      inp.onchange = ()=> resolve(inp.files[0]); inp.click();
    });
    if(!f) return;
    await fetch(upload_url,{method:'PUT',headers:{'Content-Type':'application/pdf'},body:f});
    await api('/api/contracts/'+id+'/send',{method:'POST',body:JSON.stringify({conversation_id: currentThreadId})});
    alert('Contract uploaded and sent');
  }catch(e){ alert(e.message); }
});
</script>
