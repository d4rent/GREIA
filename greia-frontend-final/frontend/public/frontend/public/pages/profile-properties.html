<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Properties - Profile - Greia</title>
<link rel="icon" type="image/png" href="../assets/greia (4).png"/>
<link href="../css/profile.css" rel="stylesheet"/>
<link href="../css/profile-nav.css" rel="stylesheet"/>
<link href="../css/main.css" rel="stylesheet"/>
<link href="../css/global-nav.css" rel="stylesheet"/>
<link href="../css/footer.css" rel="stylesheet"/>
<script src="../scripts/main.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
<style>
/* Modal Styles */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(5px);
}

.modal-overlay.show {
  display: flex;
}

.modal-content {
  background: white;
  max-width: 800px;
  width: 90vw;
  max-height: 90vh;
  border-radius: 16px;
  overflow-y: auto;
  position: relative;
  animation: modalSlideIn 0.3s ease-out;
  padding: 0;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(-20px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.modal-close {
  position: absolute;
  top: 15px;
  right: 20px;
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: #666;
  font-size: 24px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  z-index: 1000;
}

.modal-close:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(1.1);
}

.modal-content h2 {
  margin: 0 0 20px;
  color: #1c0bff;
  font-size: 1.5rem;
  padding: 30px 30px 0;
}

.modal-content > div {
  padding: 0 30px 30px;
}

/* Form Styles */
.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-size: 1.1em;
  color: #222;
  font-weight: 500;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  font-size: 1em;
  background: #f8fafc;
  transition: all 0.3s ease;
  box-sizing: border-box;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  border-color: rgb(78, 255, 146);
  background: #fff;
  outline: none;
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.form-grid-3 {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 16px;
}

/* Button Styles with Neon Green Theme */
.submit-btn {
  background: rgb(78, 255, 146);
  color: #000;
  border: none;
  border-radius: 10px;
  padding: 14px 30px;
  font-size: 1.1em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(78, 255, 146, 0.4);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.submit-btn:hover {
  background: rgb(58, 235, 126);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(78, 255, 146, 0.6);
}

.cancel-btn {
  background: transparent;
  color: #666;
  border: none;
  border-radius: 8px;
  padding: 12px 24px;
  font-size: 1em;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: underline;
}

.cancel-btn:hover {
  color: #333;
  text-decoration: none;
}

.form-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  margin-top: 24px;
}

/* Contract Agreement Styles */
.contract-terms {
  background: #f8fafc;
  padding: 20px;
  border-radius: 12px;
  margin: 20px 0;
  border-left: 4px solid rgb(78, 255, 146);
  max-height: 300px;
  overflow-y: auto;
}

.contract-terms h3 {
  color: rgb(78, 255, 146);
  margin-top: 0;
  font-size: 1.2rem;
}

.contract-checkbox {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  margin: 16px 0;
  padding: 12px;
  background: white;
  border-radius: 8px;
  border: 1px solid #e0e0e0;
}

.contract-checkbox input[type="checkbox"] {
  width: auto;
  margin: 4px 0 0 0;
  transform: scale(1.2);
  accent-color: rgb(78, 255, 146);
}

.contract-checkbox label {
  margin: 0;
  font-size: 1rem;
  line-height: 1.4;
  cursor: pointer;
}

/* Responsive Design */
@media (max-width: 768px) {
  .modal-content {
    width: 95vw;
    max-width: none;
  }
  
  .form-grid,
  .form-grid-3 {
    grid-template-columns: 1fr;
  }
}
/* Navigation Bar */
.navbar {
  background: linear-gradient(90deg, #1c0bff, #00c6d4, #1c0bff);
  background-size: 200% 100%;
  padding: 0.5rem 2rem;
  position: relative;
  box-shadow: 0 8px 20px rgba(28,11,255,0.15);
  margin-bottom: 2rem;
  animation: gradientFlow 15s linear infinite;
}

@keyframes gradientFlow {
  0% {
    background-position: 0% 50%;
  }
  100% {
    background-position: 200% 50%;
  }
}

.navbar-thirds {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 1400px;
  margin: 0 auto;
}

.navbar-third {
  flex: 1;
  display: flex;
  align-items: center;
}

.navbar-third.left {
  justify-content: flex-start;
}

.navbar-third.center {
  justify-content: center;
}

.navbar-third.right {
  justify-content: flex-end;
}

.nav-links {
  list-style: none;
  display: flex;
  gap: 2rem;
  margin: 0;
  padding: 0;
}

.nav-links li {
  position: relative;
}

.nav-links a {
  color: white;
  text-decoration: none;
  font-weight: 500;
  font-size: 1.05rem;
  transition: all 0.2s;
  display: block;
  padding: 0.5rem 0;
}

.nav-links a:hover {
  color: rgba(255,255,255,0.9);
  text-shadow: 0 0 10px rgba(255,255,255,0.3);
}

.logo img {
  max-width: 100%;
  height: auto;
  max-height: 140px;
}

.dropdown-menu {
  display: none;
  position: absolute;
  background: white;
  min-width: 200px;
  box-shadow: 0 8px 16px rgba(28,11,255,0.2);
  border-radius: 8px;
  padding: 0.5rem 0;
  z-index: 1000;
  list-style: none;
  border: 1px solid rgba(255,255,255,0.1);
}

.dropdown:hover .dropdown-menu {
  display: block;
}

.dropdown-menu a {
  padding: 0.5rem 1rem;
  font-size: 0.95rem;
  color: #1c0bff !important;
}

.dropdown-menu a:hover {
  background: rgba(28,11,255,0.05);
  color: #1c0bff !important;
  text-shadow: none !important;
}

.fancy-underline {
  position: relative;
}

.fancy-underline::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 0;
  height: 2px;
  background: #1c0bff;
  transition: width 0.3s ease;
}

.fancy-underline:hover::after {
  width: 100%;
}

@media (max-width: 768px) {
  .navbar-thirds {
    flex-direction: column;
    gap: 1rem;
  }
  
  .nav-links {
    flex-direction: column;
    gap: 1rem;
  }
  
  .dropdown-menu {
    position: static;
    box-shadow: none;
    padding-left: 1rem;
  }
  
  .logo img {
    max-height: 80px;
  }
}
/* Navigation styles */
.profile-sidebar {
  margin: 0;
  min-width: 220px;
  background: #fff;
  border-radius: 18px 0 0 18px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.08);
  padding: 32px 0;
  height: 100%;
  position: relative;
}

.sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.nav-link {
  display: block;
  padding: 14px 32px;
  color: #222;
  text-decoration: none;
  font-size: 1.08em;
  font-weight: 500;
  letter-spacing: 0.01em;
  transition: all 0.2s ease-out;
  position: relative;
}

.nav-link:hover {
  color: #1c0bff;
  background: rgba(28,11,255,0.05);
}

.nav-link.active {
  color: #1c0bff;
  background: rgba(28,11,255,0.08);
}

.nav-link.active::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 4px;
  background: #1c0bff;
}

/* Layout */
.profile-flex-layout {
  display: flex;
  align-items: flex-start;
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
  min-height: 80vh;
}

.profile-content-card {
  flex: 1;
  background: #fff;
  border-radius: 0 18px 18px 0;
  box-shadow: 0 4px 24px rgba(0,0,0,0.08);
  padding: 40px 32px;
  min-height: 80vh;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .profile-flex-layout {
    flex-direction: column;
  }
  
  .profile-sidebar {
    width: 100%;
    min-width: unset;
    border-radius: 18px 18px 0 0;
    padding: 16px 0;
  }
  
  .sidebar-nav {
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    padding: 0 16px;
  }
  
  .nav-link {
    padding: 10px 16px;
  }
  
  .profile-content-card {
    border-radius: 0 0 18px 18px;
    padding: 24px 16px;
  }
}
</style>
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar">
  <div class="navbar-thirds">
    <div class="navbar-third left">
      <ul class="nav-links left-links" style="position:relative; z-index:100;">
        <li class="dropdown" style="position:relative;">
          <a href="/pages/buy.html" style="position:relative; z-index:101;">Property</a>
          <ul class="dropdown-menu" style="top:100%; left:0; margin-top:0; padding-top:0; border-top:0;">
            <li><a href="/pages/buy.html">Buy</a></li>
            <li><a href="/pages/rent.html">Rent</a></li>
            <li><a href="/pages/commercial.html">Commercial</a></li>
            <li><a href="/pages/buy.html">Apartments</a></li>
            <li><a href="/pages/sell.html">Sell</a></li>
            <li><a href="/pages/valuations.html">Valuations</a></li>
            <li><a href="/pages/buy.html">New Homes</a></li>
          </ul>
        </li>

        <li class="dropdown" style="position:relative;">
          <a href="/pages/agents.html" style="color: rgb(78, 255, 146); position:relative; z-index:101;" class="referral-dropdown-toggle">Connect</a>
          <ul class="dropdown-menu" style="top:100%; left:0; margin-top:0; padding-top:0; border-top:0;">
            <li><a href="/pages/agents.html">Find an Agent</a></li>
            <li class="nested-dropdown" style="position: relative;">
              <a href="/pages/agents.html" class="referral-dropdown-toggle" tabindex="0" aria-haspopup="true" aria-expanded="false">Referral Agents ▸</a>
              <ul class="dropdown-menu referral-dropdown" style="display:none; position: absolute; left: 100%; top: 0; background: white; list-style:none; padding:10px; border:1px solid #ccc; min-width: 220px; z-index: 2000;">
                <li><a href="/pages/agents.html?subtype=luxury">Luxury Home Agents</a></li>
                <li><a href="/pages/agents.html?subtype=lettings">Lettings Agents</a></li>
                <li><a href="/pages/agents.html?subtype=newhomes">New Homes Agents</a></li>
                <li><a href="/pages/agents.html?subtype=commercial">Commercial Agents</a></li>
                <li><a href="/pages/agents.html?subtype=residential">Residential Agents</a></li>
                <li><a href="/pages/agents.html?subtype=developer">Developer Agents</a></li>
                <li><a href="/pages/agents.html?subtype=timeshare">Timeshare Agents</a></li>
              </ul>
            </li>
            <li><a href="/pages/coaching.html">Coaching</a></li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="navbar-third center">
      <div class="logo">
        <a href="/index.html">
          <img alt="Logo" src="../assets/greia (4).png" style="height: auto; max-height: 140px;"/>
        </a>
      </div>
    </div>
    <div class="navbar-third right">
      <ul class="nav-links right-links">
        <li>
          <a href="/pages/services.html" class="fancy-underline">Our Services</a>
        </li>
        <li>
          <a href="/pages/concierge.html" class="fancy-underline">Concierge</a>
        </li>
        <li class="dropdown" id="auth-menu">
          <a href="/pages/login.html" id="login-btn">Log In</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="profile-flex-layout">
  <!-- Sidebar Navigation -->
  <aside class="profile-sidebar">
    <nav class="sidebar-nav">
      <a href="./profile.html" class="nav-link">Profile</a>
      <a href="./profile-properties.html" class="nav-link active">Properties</a>
      <a href="./profile-ads.html" class="nav-link">Advertisements</a>
      <a href="./profile-services.html" class="nav-link">Services</a>
      <a href="./profile-inbox.html" class="nav-link">Inbox</a>
      <a href="./profile-saved.html" class="nav-link">Saved Items</a>
      <a href="./analytics.html" class="nav-link">Analytics</a>
      <a href="./profile-subscriptions.html" class="nav-link">Packages & Memberships</a>
      <a href="./profile-settings.html" class="nav-link">Settings</a>
      <a href="./admindashboard.html" class="nav-link" id="nav-admin-dashboard" style="display:none;">Admin Dashboard</a>
      <a href="../auth/logout.html" class="nav-link" id="nav-logout">Logout</a>
    </nav>
  </aside>

  <!-- Main Content Area -->
  <section class="profile-content-card">
    <div class="profile-section-content">
      <h2 style="margin-bottom: 24px;" id="page-title">Your Properties</h2>

      <!-- Role-specific info banner -->
      <div id="role-info-banner" style="display: none; margin-bottom: 24px; padding: 16px; border-radius: 12px; border-left: 4px solid #1c0bff;">
        <div id="banner-content"></div>
      </div>

      <!-- Feature Boxes -->
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 32px;">
        <div style="background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <h3 style="margin: 0 0 8px; color: #1c0bff; font-size: 16px;">Active Listings</h3>
          <div style="font-size: 24px; font-weight: 600;">0</div>
          <div style="color: #666; font-size: 14px; margin-top: 4px;">Currently Listed</div>
        </div>
        <div style="background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); cursor: pointer;" onclick="toggleInbox()">
          <h3 style="margin: 0 0 8px; color: #1c0bff; font-size: 16px;">New Messages</h3>
          <div style="font-size: 24px; font-weight: 600;">0</div>
          <div style="color: #666; font-size: 14px; margin-top: 4px;">Click to View Inbox</div>
        </div>
        <div style="background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <h3 style="margin: 0 0 8px; color: #1c0bff; font-size: 16px;">Average Price</h3>
          <div style="font-size: 24px; font-weight: 600;">€0</div>
          <div style="color: #666; font-size: 14px; margin-top: 4px;">Current Listings</div>
        </div>
        <div style="background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <h3 style="margin: 0 0 8px; color: #1c0bff; font-size: 16px;">Total Properties</h3>
          <div style="font-size: 24px; font-weight: 600;">0</div>
          <div style="color: #666; font-size: 14px; margin-top: 4px;">All Time</div>
        </div>
        <div style="background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <h3 style="margin: 0 0 8px; color: #1c0bff; font-size: 16px;">Total Views</h3>
          <div style="font-size: 24px; font-weight: 600;">0</div>
          <div style="color: #666; font-size: 14px; margin-top: 4px;">This Month</div>
        </div>
        <div style="background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <h3 style="margin: 0 0 8px; color: #1c0bff; font-size: 16px;">Success Rate</h3>
          <div style="font-size: 24px; font-weight: 600;">0%</div>
          <div style="color: #666; font-size: 14px; margin-top: 4px;">Sold/Rented</div>
        </div>
      </div>

      <!-- Inbox Section (Initially Hidden) -->
      <div id="property-inbox" style="display:none; margin-bottom: 32px;">
        <div style="background: #fff; border-radius: 12px; padding: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="margin: 0; color: #1c0bff; font-size: 18px;">Property Inquiries Inbox</h3>
            <button onclick="toggleInbox()" style="background: #00ffa2; color: black; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.3s ease;">Close Inbox</button>
          </div>
          <div class="inbox-messages" style="max-height: 400px; overflow-y: auto;">
            <!-- Messages will be loaded here -->
            <div style="text-align: center; color: #666; padding: 20px;">No new messages</div>
          </div>
        </div>
      </div>

      <div style="display: flex; justify-content: flex-end; margin: 0 32px 24px 0;">
        <button onclick="showPropertyContractModal()" style="background: rgb(78, 255, 146); color: black; border: none; padding: 12px 32px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.4s ease; box-shadow: 0 4px 15px rgba(78, 255, 146, 0.4);" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(78, 255, 146, 0.6)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 15px rgba(78, 255, 146, 0.4)'">Add New Property</button>
      </div>

      <div class="profile-card-grid" id="user-listings-grid">
    <!-- Search & Filters (Properties) -->
    <div class="search-filter-bar" style="display:flex;flex-wrap:wrap;align-items:center;gap:16px;margin-bottom:24px;background:#f4f8fc;padding:16px 20px;border-radius:10px;box-shadow:0 2px 8px #e0e7ef;">
      <input type="text" id="property-search-keyword" placeholder="🔍 Search by keyword, address, or title" style="flex:2;min-width:180px;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;">
      <input type="text" id="property-search-location" placeholder="Location (city/county)" style="flex:1;min-width:120px;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;">
      <select id="property-search-type" style="flex:1;min-width:120px;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;">
        <option value="">Type</option>
        <option value="letting">Letting</option>
        <option value="residential">Residential</option>
        <option value="apartment">Apartment</option>
        <option value="luxury home">Luxury Home</option>
        <option value="country home">Country Home</option>
        <option value="studio">Studio</option>
        <option value="office">Office</option>
        <option value="other">Other</option>
      </select>
      <select id="property-search-bedrooms" style="flex:1;min-width:80px;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;">
        <option value="">Bedrooms</option>
        <option value="1">1+</option>
        <option value="2">2+</option>
        <option value="3">3+</option>
        <option value="4">4+</option>
        <option value="5">5+</option>
      </select>
      <select id="property-search-bathrooms" style="flex:1;min-width:80px;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;">
        <option value="">Bathrooms</option>
        <option value="1">1+</option>
        <option value="2">2+</option>
        <option value="3">3+</option>
      </select>
      <input type="number" id="property-search-price-min" placeholder="Min €" style="width:90px;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;">
      <input type="number" id="property-search-price-max" placeholder="Max €" style="width:90px;padding:8px 12px;border-radius:6px;border:1px solid #cbd5e1;">
      <label style="display:flex;align-items:center;gap:6px;font-size:14px;">
        <input type="checkbox" id="property-search-featured">
        Featured Only
      </label>
      <button type="button" onclick="searchProperties()" style="background:rgb(78, 255, 146);color:black;border:none;padding:12px 28px;border-radius:10px;cursor:pointer;white-space:nowrap;transition:all 0.4s ease;box-shadow:0 4px 15px rgba(78, 255, 146, 0.4);font-weight:600;">Search</button>
    </div>
    <!-- Properties will be loaded here -->
    <p style="color: #888; text-align: center; grid-column: 1/-1;">No properties listed yet.</p>
    <!-- Map Integration -->
    <div id="property-map" style="width:100%;height:400px;border-radius:10px;margin-top:24px;margin-bottom:24px;box-shadow:0 4px 12px rgba(0,0,0,0.1);"></div>
  </div>

  <!-- Property Management JS -->
  <script>
    const API_BASE_URL = window.API_BASE_URL || 'https://api.d4rent.ie';
    const token = localStorage.getItem('token');
    let currentUser = null;

    async function fetchUserProperties() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/properties?user=${currentUser?.id || 'me'}`, {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        let properties = response.ok ? await response.json() : [];
        properties = properties.filter(p => p.user_id == currentUser?.id);
        displayUserProperties(properties);
      } catch (error) {
        displayUserProperties([]);
      }
    }

    async function displayUserProperties(properties) {
      const grid = document.getElementById('user-listings-grid');
      if (!grid) return;
      if (properties.length === 0) {
        grid.innerHTML = '<p style="color: #888; text-align: center; grid-column: 1/-1;">No properties listed yet.</p>';
        return;
      }

      // Display the property cards
      grid.innerHTML = properties.map(property => {
        // Determine status badge based on workflow_status and user role
        let statusBadge = '';
        if (property.workflow_status === 'pending_admin_approval') {
          statusBadge = '<div style="background: #ff9800; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 8px;">⏳ Pending Admin Approval</div>';
        } else if (property.workflow_status === 'public_listing') {
          statusBadge = '<div style="background: rgb(78, 255, 146); color: black; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 8px;">� Live Listing</div>';
        } else if (property.approved === '1') {
          statusBadge = '<div style="background: #4caf50; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 8px;">✅ Approved & Live</div>';
        } else {
          statusBadge = '<div style="background: #f44336; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 8px;">❌ Not Approved</div>';
        }

        return `
          <div class="profile-card">
            <img class="property-card-img" src="${property.image ? (property.image.startsWith('http') ? property.image : '/uploads/' + property.image) : '../assets/sold buy.png'}" alt="${property.title || 'Property'}">
            ${statusBadge}
            <div class="property-card-title">${property.title || 'Untitled Property'}</div>
            <div class="property-card-address">${property.address || 'Address not specified'}</div>
            <div class="property-card-price">${property.price || 'Price on request'}</div>
            <div class="property-card-type">${property.type || 'Property'}</div>
            <div class="profile-card-actions">
              <button class="profile-card-btn" onclick="editProperty(${property.id})">Edit</button>
              <button class="profile-card-btn" onclick="deleteProperty(${property.id})">Delete</button>
              <a href="/pages/propertytemplate.html?id=${property.id}" class="profile-card-btn">View</a>
              ${property.workflow_status === 'public_listing' ? '<a href="/pages/your-new-page.html?property=' + property.id + '" class="profile-card-btn" style="background: rgb(78, 255, 146); color: black;">View on Platform</a>' : ''}
            </div>
          </div>
        `;
      }).join('');

      // Initialize geocoder
      const geocoder = new google.maps.Geocoder();
      
      // Clear existing markers
      markers.forEach(marker => marker.setMap(null));
      markers = [];

      // Create bounds to fit all properties
      const bounds = new google.maps.LatLngBounds();
      
      // Geocode and add markers for each property
      for (const property of properties) {
        if (property.address) {
          try {
            const result = await new Promise((resolve, reject) => {
              geocoder.geocode({ address: property.address + ', Ireland' }, (results, status) => {
                if (status === 'OK') {
                  resolve(results[0]);
                } else {
                  reject(status);
                }
              });
            });

            const position = result.geometry.location;
            
            // Create marker
            const marker = new google.maps.Marker({
              position: position,
              map: map,
              title: property.title,
              animation: google.maps.Animation.DROP
            });

            // Create info window
            const infoWindow = new google.maps.InfoWindow({
              content: `
                <div style="padding:12px;max-width:300px;">
                  <h3 style="margin:0 0 8px;font-size:16px;color:#1c0bff;">${property.title}</h3>
                  <p style="margin:0 0 4px;color:#666;">${property.address}</p>
                  <p style="margin:0 0 8px;font-weight:bold;font-size:18px;">€${property.price ? property.price.toLocaleString() : 'Price on request'}</p>
                  ${property.type ? `<p style="margin:0;color:#666;font-size:14px;">Type: ${property.type}</p>` : ''}
                  <a href="/pages/propertytemplate.html?id=${property.id}" style="display:inline-block;margin-top:8px;color:#1c0bff;text-decoration:none;font-weight:500;">View Details →</a>
                </div>
              `
            });

            // Add click listener to marker
            marker.addListener('click', () => {
              // Close all open info windows first
              markers.forEach(m => m.infoWindow?.close());
              infoWindow.open(map, marker);
            });

            // Store the info window with the marker
            marker.infoWindow = infoWindow;
            markers.push(marker);
            bounds.extend(position);
          } catch (error) {
            console.warn(`Could not geocode address: ${property.address}`, error);
          }
        }
      }

      // Fit map to show all markers if there are any
      if (markers.length > 0) {
        map.fitBounds(bounds);
        // Don't zoom in too close if only one marker
        if (map.getZoom() > 16) map.setZoom(16);
      }
    }

    document.getElementById('add-property-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      
      // Set different workflows based on user role
      if (currentUser.role === 'property_agent') {
        // Property agents: requires admin approval
        formData.append('approved', '0');
        formData.append('workflow_status', 'pending_admin_approval');
        formData.append('listing_source', 'agent');
        formData.append('agent_id', currentUser.id);
      } else {
        // Everyone else: goes to the new page you'll create
        formData.append('approved', '1'); // Auto-approved for non-agent listings
        formData.append('workflow_status', 'public_listing');
        formData.append('listing_source', 'public');
        formData.append('owner_id', currentUser.id);
        formData.append('public_marketplace', '1'); // Flag for the new page
      }
      
      formData.append('user_role', currentUser.role);
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/properties`, {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token },
          body: formData
        });
        if (!response.ok) throw new Error('Failed to add property');
        
        // Different success messages based on role
        if (currentUser.role === 'property_agent') {
          alert('Property submitted successfully! It will be reviewed by our admin team before going live on the main property pages.');
        } else {
          alert('Property listed successfully! It\'s now live on our public marketplace where licensed agents can discover it.');
        }
        
        hideAddPropertyForm();
        fetchUserProperties();
      } catch (error) {
        alert('Error adding property: ' + error.message);
      }
    });

    document.getElementById('property-edit-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const propertyId = document.getElementById('edit-property-id').value;
      try {
        const response = await fetch(`${API_BASE_URL}/api/properties/${propertyId}`, {
          method: 'PUT',
          headers: { 'Authorization': 'Bearer ' + token },
          body: formData
        });
        if (!response.ok) throw new Error('Failed to update property');
        alert('Property updated successfully!');
        hideEditPropertyForm();
        fetchUserProperties();
      } catch (error) {
        alert('Error updating property.');
      }
    });

    function showPropertyContractModal() {
      // Check if user is logged in
      if (!currentUser) {
        alert('Please log in to list properties.');
        window.location.href = '/pages/login.html';
        return;
      }

      // Only restrict admin and service agents - everyone else can list properties
      if (currentUser.role === 'admin' || currentUser.role === 'service_agent' || currentUser.role === 'coach') {
        alert('Property listings are not available for your account type.');
        return;
      }

      // Customize modal content based on user role
      const modalTitle = document.getElementById('contract-modal-title');
      const roleSpecificTerms = document.getElementById('role-specific-terms');
      const ownershipLabel = document.getElementById('ownership-label');

      if (currentUser.role === 'property_agent') {
        modalTitle.textContent = 'Agent Property Listing Agreement';
        roleSpecificTerms.innerHTML = `
          <div style="background: #e3f2fd; padding: 16px; border-radius: 8px; margin: 16px 0; border-left: 4px solid #1c0bff;">
            <h4 style="margin: 0 0 8px; color: #1c0bff;">🏢 Licensed Agent Listing Process</h4>
            <p style="margin: 0; font-size: 14px; color: #555;">
              • Your property will be submitted for admin review<br>
              • Admin approval required before listing goes live on main property pages<br>
              • You'll be notified once approved via email<br>
              • Professional agent verification may be required<br>
              • Licensed agents can also browse the public marketplace to find properties to represent
            </p>
          </div>
        `;
        ownershipLabel.textContent = 'I confirm I am a licensed property agent authorized to list this property';
      } else {
        // Everyone else (customers, property owners, etc.)
        modalTitle.textContent = 'Property Listing Agreement';
        roleSpecificTerms.innerHTML = `
          <div style="background: #e8f5e9; padding: 16px; border-radius: 8px; margin: 16px 0; border-left: 4px solid rgb(78, 255, 146);">
            <h4 style="margin: 0 0 8px; color: #2e7d32;">🏠 Public Marketplace Listing Process</h4>
            <p style="margin: 0; font-size: 14px; color: #555;">
              • Your property will be listed on our public marketplace<br>
              • Licensed agents can discover and choose to represent your property<br>
              • If an agent represents your property, it will go to our main property pages<br>
              • You can manage and edit your listings anytime<br>
              • Direct contact from interested agents and parties
            </p>
          </div>
        `;
        ownershipLabel.textContent = 'I confirm I am authorized to list this property';
      }

      document.getElementById('property-contract-modal').style.display = 'flex';
      setTimeout(() => document.getElementById('property-contract-modal').classList.add('show'), 10);
    }

    function showAddPropertyForm() {
      showPropertyContractModal();
    }

    function proceedToPropertyForm() {
      const agree = document.getElementById('property-contract-agree').checked;
      const owner = document.getElementById('property-ownership-confirm').checked;
      if (!agree || !owner) {
        alert('You must agree to the terms and confirm ownership to continue.');
        return;
      }
      hidePropertyContract();
      setTimeout(() => {
        document.getElementById('add-property-modal').style.display = 'flex';
        setTimeout(() => document.getElementById('add-property-modal').classList.add('show'), 10);
      }, 300);
    }

    function hidePropertyContract() {
      const modal = document.getElementById('property-contract-modal');
      modal.classList.remove('show');
      setTimeout(() => modal.style.display = 'none', 300);
    }

    function hideAddPropertyForm() {
      const modal = document.getElementById('add-property-modal');
      modal.classList.remove('show');
      setTimeout(() => modal.style.display = 'none', 300);
    }

    function showEditPropertyForm(property) {
      document.getElementById('edit-property-modal').style.display = 'flex';
      setTimeout(() => {
        document.getElementById('edit-property-modal').classList.add('show');
        document.getElementById('edit-property-id').value = property.id;
        document.getElementById('edit-property-title').value = property.title || '';
        document.getElementById('edit-property-address').value = property.address || '';
        document.getElementById('edit-property-price').value = property.price || '';
        document.getElementById('edit-property-description').value = property.description || '';
      }, 10);
    }

    function hideEditPropertyForm() {
      const modal = document.getElementById('edit-property-modal');
      modal.classList.remove('show');
      setTimeout(() => {
        modal.style.display = 'none';
        document.getElementById('property-edit-form').reset();
      }, 300);
    }
    async function editProperty(propertyId) {
      try {
        const response = await fetch(`${API_BASE_URL}/api/properties/${propertyId}`, {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        if (!response.ok) throw new Error('Failed to fetch property');
        const property = await response.json();
        showEditPropertyForm(property);
      } catch (error) {
        alert('Error loading property data');
      }
    }
    async function deleteProperty(propertyId) {
      if (confirm('Are you sure you want to delete this property?')) {
        try {
          const response = await fetch(`${API_BASE_URL}/api/properties/${propertyId}`, {
            method: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + token }
          });
          if (!response.ok) throw new Error('Failed to delete property');
          fetchUserProperties();
        } catch (error) {
          alert('Error deleting property');
        }
      }
    }
    let map;
    let markers = [];

    function initMap() {
      // Center on Dublin, Ireland
      const dublin = { lat: 53.3498, lng: -6.2603 };
      map = new google.maps.Map(document.getElementById("property-map"), {
        zoom: 13,
        center: dublin,
        styles: [
          {
            featureType: "all",
            elementType: "geometry",
            stylers: [{ color: "#f8f9fa" }]
          },
          {
            featureType: "water",
            elementType: "geometry",
            stylers: [{ color: "#e3f2fd" }]
          },
          {
            featureType: "poi",
            elementType: "labels.text.fill",
            stylers: [{ color: "#1c0bff" }]
          },
          {
            featureType: "poi.park",
            elementType: "geometry",
            stylers: [{ color: "#e8f5e9" }]
          },
          {
            featureType: "road.highway",
            elementType: "geometry",
            stylers: [{ color: "#ffffff" }]
          },
          {
            featureType: "road.arterial",
            elementType: "geometry",
            stylers: [{ color: "#ffffff" }]
          },
          {
            featureType: "road.local",
            elementType: "geometry",
            stylers: [{ color: "#ffffff" }]
          },
          {
            featureType: "transit.station",
            elementType: "labels.text.fill",
            stylers: [{ color: "#1c0bff" }]
          },
          {
            featureType: "administrative.neighborhood",
            elementType: "labels.text.fill",
            stylers: [{ color: "#1c0bff" }]
          }
        ],
        mapTypeControl: true,
        mapTypeControlOptions: {
          style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
        },
        streetViewControl: true,
        fullscreenControl: true
      });

      // Add search box
      const input = document.getElementById('property-search-location');
      const searchBox = new google.maps.places.SearchBox(input);

      map.addListener('bounds_changed', () => {
        searchBox.setBounds(map.getBounds());
      });

      searchBox.addListener('places_changed', () => {
        const places = searchBox.getPlaces();
        if (places.length === 0) return;

        const bounds = new google.maps.LatLngBounds();
        places.forEach(place => {
          if (!place.geometry || !place.geometry.location) return;

          if (place.geometry.viewport) {
            bounds.union(place.geometry.viewport);
          } else {
            bounds.extend(place.geometry.location);
          }
        });
        map.fitBounds(bounds);
      });
    }

    function addPropertyMarkers(properties) {
      // Clear existing markers
      markers.forEach(marker => marker.setMap(null));
      markers = [];

      properties.forEach(property => {
        // You would need to add latitude and longitude to your property data
        if (property.lat && property.lng) {
          const marker = new google.maps.Marker({
            position: { lat: property.lat, lng: property.lng },
            map: map,
            title: property.title,
            animation: google.maps.Animation.DROP
          });

          const infoWindow = new google.maps.InfoWindow({
            content: `
              <div style="padding:8px;">
                <h3 style="margin:0 0 8px;font-size:16px;">${property.title}</h3>
                <p style="margin:0 0 4px;">${property.address}</p>
                <p style="margin:0;font-weight:bold;">€${property.price}</p>
              </div>
            `
          });

          marker.addListener('click', () => {
            infoWindow.open(map, marker);
          });

          markers.push(marker);
        }
      });
    }

    function toggleInbox() {
      const inbox = document.getElementById('property-inbox');
      inbox.style.display = inbox.style.display === 'none' ? 'block' : 'none';
      if (inbox.style.display === 'block') {
        fetchInboxMessages();
      }
    }

    async function fetchInboxMessages() {
      try {
        // Replace this with your actual API call
        const response = await fetch(`${API_BASE_URL}/api/messages/properties`, {
          headers: { 'Authorization': 'Bearer ' + token }
        });
        if (!response.ok) throw new Error('Failed to fetch messages');
        const messages = await response.json();
        displayInboxMessages(messages);
      } catch (error) {
        console.error('Error fetching messages:', error);
        displayInboxMessages([]);
      }
    }

    function displayInboxMessages(messages) {
      const inboxContainer = document.querySelector('.inbox-messages');
      if (!messages || messages.length === 0) {
        inboxContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No new messages</div>';
        return;
      }

      inboxContainer.innerHTML = messages.map(message => `
        <div style="padding: 16px; border-bottom: 1px solid #eee; transition: background 0.3s ease;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='#fff'">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <strong style="color: #1c0bff;">${message.subject || 'Property Inquiry'}</strong>
            <span style="color: #666; font-size: 14px;">${new Date(message.date).toLocaleDateString()}</span>
          </div>
          <div style="color: #444; margin-bottom: 8px;">${message.message}</div>
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: #666; font-size: 14px;">From: ${message.sender}</span>
            <button onclick="replyToMessage('${message.id}')" style="background: #00ffa2; color: black; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 14px;">Reply</button>
          </div>
        </div>
      `).join('');

      // Update message count in the feature box
      const messageCount = document.querySelector('h3:contains("New Messages")').nextElementSibling;
      if (messageCount) {
        messageCount.textContent = messages.length;
      }
    }

    function replyToMessage(messageId) {
      // Implement reply functionality
      console.log('Reply to message:', messageId);
      // You can show a modal or navigate to a reply form
    }

    document.addEventListener('DOMContentLoaded', async function() {
      // Load current user data first
      if (token) {
        try {
          const response = await fetch(`${API_BASE_URL}/api/user/profile`, {
            headers: { 'Authorization': 'Bearer ' + token }
          });
          if (response.ok) {
            currentUser = await response.json();
            console.log('Current user loaded:', currentUser);
            updateUIBasedOnRole();
          }
        } catch (error) {
          console.error('Error loading user data:', error);
        }
      }
      
      fetchUserProperties();
      initMap();
      // Fetch initial message count
      fetchInboxMessages();
    });

    // Update UI based on user role
    function updateUIBasedOnRole() {
      const addPropertyBtn = document.querySelector('button[onclick="showPropertyContractModal()"]');
      const pageTitle = document.getElementById('page-title');
      const roleInfoBanner = document.getElementById('role-info-banner');
      const bannerContent = document.getElementById('banner-content');
      
      if (!addPropertyBtn || !pageTitle || !roleInfoBanner || !bannerContent) return;

      if (!currentUser) {
        addPropertyBtn.style.display = 'none';
        return;
      }

      // Allow everyone except admin, service_agent, and coach
      if (currentUser.role === 'property_agent') {
        pageTitle.textContent = '🏢 Agent Property Listings';
        addPropertyBtn.innerHTML = '🏢 Add Property (Agent)';
        addPropertyBtn.title = 'Properties will be reviewed by admin before going live on main property pages';
        
        roleInfoBanner.style.display = 'block';
        roleInfoBanner.style.background = '#e3f2fd';
        roleInfoBanner.style.borderColor = '#1c0bff';
        bannerContent.innerHTML = `
          <h4 style="margin: 0 0 8px; color: #1c0bff;">🏢 Licensed Agent Dashboard</h4>
          <p style="margin: 0; color: #555; font-size: 14px;">
            As a licensed property agent, your listings go to our main property pages after admin approval. 
            You can also browse the public marketplace to find properties to represent professionally.
          </p>
        `;
      } else if (currentUser.role === 'admin' || currentUser.role === 'service_agent' || currentUser.role === 'coach') {
        // Hide for admin, service agents, and coaches
        addPropertyBtn.style.display = 'none';
        pageTitle.textContent = 'Property Access Restricted';
        roleInfoBanner.style.display = 'block';
        roleInfoBanner.style.background = '#fff3e0';
        roleInfoBanner.style.borderColor = '#ff9800';
        bannerContent.innerHTML = `
          <h4 style="margin: 0 0 8px; color: #ef6c00;">⚠️ Access Restricted</h4>
          <p style="margin: 0; color: #555; font-size: 14px;">
            Property listings are not available for your account type. 
            Contact admin if you need to change your account type.
          </p>
        `;
      } else {
        // Everyone else (customers and other roles)
        pageTitle.textContent = '🏠 Your Property Listings';
        addPropertyBtn.innerHTML = '🏠 List Property';
        addPropertyBtn.title = 'Your property will be listed on our public marketplace for agents to discover';
        
        roleInfoBanner.style.display = 'block';
        roleInfoBanner.style.background = '#e8f5e9';
        roleInfoBanner.style.borderColor = 'rgb(78, 255, 146)';
        bannerContent.innerHTML = `
          <h4 style="margin: 0 0 8px; color: #2e7d32;">🏠 Public Property Marketplace</h4>
          <p style="margin: 0; color: #555; font-size: 14px;">
            Your property goes to our public marketplace where licensed agents can discover it. 
            If an agent chooses to represent your property, it will be professionally listed on our main property pages.
          </p>
        `;
      }
    }

    // Close modals when clicking outside
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal-overlay')) {
        if (e.target.id === 'property-contract-modal') {
          hidePropertyContract();
        } else if (e.target.id === 'add-property-modal') {
          hideAddPropertyForm();
        } else if (e.target.id === 'edit-property-modal') {
          hideEditPropertyForm();
        }
      }
    });

    // Close modals with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        hidePropertyContract();
        hideAddPropertyForm();
        hideEditPropertyForm();
      }
    });
  </script>
</div>
    </section>
  </div>

  <!-- Property Contract Modal -->
  <div id="property-contract-modal" class="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" onclick="hidePropertyContract()">&times;</button>
      <div id="property-contract-form">
        <h2 id="contract-modal-title">Property Listing Agreement</h2>
        <div class="contract-terms">
          <h3>Terms and Conditions</h3>
          <div id="contract-content">
            <p>By listing your property on our platform, you agree to:</p>
            <ul>
              <li>Provide accurate and truthful information about your property</li>
              <li>Maintain the property in good condition during the listing period</li>
              <li>Respond to inquiries in a timely manner</li>
              <li>Confirm that you are the legal owner or authorized agent</li>
              <li>Comply with all local housing and safety regulations</li>
              <li>Update listing status promptly when property becomes unavailable</li>
            </ul>
            
            <div id="role-specific-terms"></div>
          </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:16px;margin-bottom:20px;">
          <div class="contract-checkbox">
            <input type="checkbox" id="property-contract-agree">
            <label for="property-contract-agree">I agree to the property listing terms and conditions</label>
          </div>
          <div class="contract-checkbox">
            <input type="checkbox" id="property-ownership-confirm">
            <label for="property-ownership-confirm" id="ownership-label">I confirm I am the legal owner or authorized to list this property</label>
          </div>
        </div>
        <div class="form-actions">
          <button class="cancel-btn" onclick="hidePropertyContract()">Cancel</button>
          <button class="submit-btn" onclick="proceedToPropertyForm()">I Agree</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Property Modal -->
  <div id="add-property-modal" class="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" onclick="hideAddPropertyForm()">&times;</button>
      <div id="add-property-form-container">
        <h2>Add New Property</h2>
        <form id="add-property-form">
          <!-- Basic Information -->
          <div class="form-grid">
            <div class="form-group">
              <label for="property-title">Property Title:</label>
              <input type="text" id="property-title" name="title" required placeholder="e.g. Beautiful 3-Bed House in Dublin">
            </div>
            <div class="form-group">
              <label for="property-price">Price (€):</label>
              <input type="number" id="property-price" name="price" required min="0" step="0.01" placeholder="e.g. 450000">
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="property-rent-price">Rent Price (€/month):</label>
              <input type="number" id="property-rent-price" name="rent_price" min="0" step="0.01" placeholder="e.g. 2500">
            </div>
            <div class="form-group">
              <label for="property-deposit">Deposit (€):</label>
              <input type="number" id="property-deposit" name="deposit" min="0" step="0.01" placeholder="e.g. 5000">
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="property-type">Property Type:</label>
              <select id="property-type" name="property_type" required>
                <option value="">Select Type</option>
                <option value="letting">Letting</option>
                <option value="residential">Residential</option>
                <option value="new home">New Home</option>
                <option value="luxury home">Luxury Home</option>
                <option value="country home">Country Home</option>
                <option value="apartment">Apartment</option>
                <option value="sublet">Sublet</option>
                <option value="new developments">New Developments</option>
                <option value="studio apartment">Studio Apartment</option>
                <option value="student accommodation">Student Accommodation</option>
                <option value="timeshare">Timeshare</option>
                <option value="office">Office</option>
                <option value="restaurant/bar">Restaurant/Bar</option>
                <option value="cafe">Cafe</option>
                <option value="auction">Auction</option>
                <option value="agricultural site">Agricultural Site</option>
                <option value="investment property">Investment Property</option>
                <option value="development site">Development Site</option>
                <option value="short term">Short Term</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="property-status">Status:</label>
              <select id="property-status" name="status" required>
                <option value="">Select Status</option>
                <option value="for sale">For Sale</option>
                <option value="sale agreed">Sale Agreed</option>
                <option value="sold">Sold</option>
                <option value="to let">To Let</option>
                <option value="letting agreed">Letting Agreed</option>
              </select>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="property-listing-type">Listing Type:</label>
              <select id="property-listing-type" name="listing_type" required>
                <option value="">Select Type</option>
                <option value="agent">Agent</option>
                <option value="owner">Owner</option>
                <option value="developer">Developer</option>
              </select>
            </div>
            <div class="form-group">
              <label for="property-bedrooms">Bedrooms:</label>
              <input type="number" id="property-bedrooms" name="bedrooms" min="0" max="20" placeholder="e.g. 3">
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="property-bathrooms">Bathrooms:</label>
              <input type="number" id="property-bathrooms" name="bathrooms" min="0" max="10" step="0.5" placeholder="e.g. 2">
            </div>
            <div class="form-group">
              <label for="property-size">Size (sq ft):</label>
              <input type="number" id="property-size" name="size_sqft" min="0" placeholder="e.g. 1200">
            </div>
          </div>

          <div class="form-grid-3">
            <div class="form-group">
              <label for="property-area">Area:</label>
              <input type="text" id="property-area" name="area" placeholder="e.g. Dublin 4">
            </div>
            <div class="form-group">
              <label for="property-region">Region:</label>
              <input type="text" id="property-region" name="region" placeholder="e.g. ireland" value="ireland">
            </div>
            <div class="form-group">
              <label for="property-price-period">Price Period:</label>
              <select id="property-price-period" name="price_period">
                <option value="">Select Period</option>
                <option value="per month">Per Month</option>
                <option value="per week">Per Week</option>
                <option value="per year">Per Year</option>
                <option value="once">One-time Payment</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="property-address">Address:</label>
            <textarea id="property-address" name="address" rows="2" required placeholder="Full property address"></textarea>
          </div>

          <div class="form-grid-3">
            <div class="form-group">
              <label for="property-city">City:</label>
              <input type="text" id="property-city" name="city" required placeholder="e.g. Dublin">
            </div>
            <div class="form-group">
              <label for="property-county">County:</label>
              <input type="text" id="property-county" name="county" required placeholder="e.g. Dublin">
            </div>
            <div class="form-group">
              <label for="property-eircode">Eircode:</label>
              <input type="text" id="property-eircode" name="eircode" maxlength="10" placeholder="e.g. D02 XY45">
            </div>
          </div>

          <div class="form-group">
            <label for="property-description">Description:</label>
            <textarea id="property-description" name="description" rows="4" placeholder="Describe the property in detail..."></textarea>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="property-heating">Heating Type:</label>
              <input type="text" id="property-heating" name="heating" placeholder="e.g. Gas central heating">
            </div>
            <div class="form-group">
              <label for="property-parking">Parking:</label>
              <input type="text" id="property-parking" name="parking" placeholder="e.g. 2 car driveway">
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="property-garden">Garden:</label>
              <select id="property-garden" name="garden">
                <option value="">Select Garden</option>
                <option value="None">No Garden</option>
                <option value="Small">Small Garden</option>
                <option value="Medium">Medium Garden</option>
                <option value="Large">Large Garden</option>
                <option value="Front and Back">Front and Back</option>
              </select>
            </div>
            <div class="form-group">
              <label for="property-furnished">Furnished:</label>
              <select id="property-furnished" name="furnished">
                <option value="">Select Furnishing</option>
                <option value="Unfurnished">Unfurnished</option>
                <option value="Part Furnished">Part Furnished</option>
                <option value="Fully Furnished">Fully Furnished</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="property-features">Features:</label>
            <textarea id="property-features" name="features" rows="3" placeholder="List key features of the property (separate with commas)"></textarea>
            <small style="color: #666; display: block; margin-top: 4px;">E.g.: Open fireplace, High ceilings, Modern kitchen, etc.</small>
          </div>

          <div class="form-group">
            <label for="property-images">Property Images:</label>
            <input type="file" id="property-images" name="image" accept="image/*" multiple>
            <small style="color: #666; display: block; margin-top: 4px;">Upload multiple images of your property (max 10 files)</small>
          </div>

          <div class="form-actions">
            <button type="button" class="cancel-btn" onclick="hideAddPropertyForm()">Cancel</button>
            <button type="submit" class="submit-btn">Submit Property</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Property Modal -->
  <div id="edit-property-modal" class="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" onclick="hideEditPropertyForm()">&times;</button>
      <div id="edit-property-form-container">
        <h2>Edit Property</h2>
        <form id="property-edit-form">
          <input type="hidden" id="edit-property-id" name="id">
          
          <div class="form-grid">
            <div class="form-group">
              <label for="edit-property-title">Property Title:</label>
              <input type="text" id="edit-property-title" name="title" required>
            </div>
            <div class="form-group">
              <label for="edit-property-price">Price (€):</label>
              <input type="number" id="edit-property-price" name="price" required min="0" step="0.01">
            </div>
          </div>

          <div class="form-group">
            <label for="edit-property-address">Address:</label>
            <textarea id="edit-property-address" name="address" rows="2" required></textarea>
          </div>

          <div class="form-group">
            <label for="edit-property-description">Description:</label>
            <textarea id="edit-property-description" name="description" rows="4" required></textarea>
          </div>

          <div class="form-actions">
            <button type="button" class="cancel-btn" onclick="hideEditPropertyForm()">Cancel</button>
            <button type="submit" class="submit-btn">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Footer -->
  

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<div data-include="/components/footer.html"></div>
<script src="/public/js/greia-auto-mount.js"></script>
<script src="/scripts/includes.js"></script>
</body>
</html>

<script>
document.addEventListener('click', async (e)=>{
  const btn = e.target.closest('[data-boost-prop-id]'); if(!btn) return;
  const id = btn.getAttribute('data-boost-prop-id');
  const pkg = prompt('Package key (e.g., homepage-7d):');
  if(!pkg) return;
  try{
    const r = await fetch('/api/exposure/checkout', {method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body: JSON.stringify({ listing_type:'property', listing_id: Number(id), package: pkg })});
    const d = await r.json(); if(d.url) location.href=d.url; else alert('Checkout failed');
  }catch(e){ alert(e.message); }
});
</script>

<script>
// Enhance property cards: add Contact and Boost buttons if not present.
// Looks for elements with [data-prop-id] or [data-property-id].
document.addEventListener('DOMContentLoaded', ()=>{
  const cards = document.querySelectorAll('[data-prop-id], [data-property-id]');
  cards.forEach(card=>{
    const pid = card.getAttribute('data-prop-id') || card.getAttribute('data-property-id');
    if(!pid) return;
    const footer = card.querySelector('.card-actions') || card.appendChild(Object.assign(document.createElement('div'),{className:'card-actions', style:'margin-top:8px;display:flex;gap:8px;'}));
    if(!footer.querySelector('[data-contact-prop-id]')){
      const c = document.createElement('button');
      c.className = 'btn primary'; c.textContent = 'Contact';
      c.setAttribute('data-contact-prop-id', pid);
      footer.appendChild(c);
    }
    if(!footer.querySelector('[data-boost-prop-id]')){
      const b = document.createElement('button');
      b.className = 'btn'; b.textContent = 'Boost Exposure';
      b.setAttribute('data-boost-prop-id', pid);
      footer.appendChild(b);
    }
  });
});
</script>
